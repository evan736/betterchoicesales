(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[270],{7653:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3756:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6942:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2297:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3718:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1352:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(4297).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6640:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/statements",function(){return s(9008)}])},9008:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(5893),l=s(7294),i=s(1163),r=s(9835),n=s(3740),d=s(8856),c=s(8142),o=s(7653),x=s(3756),m=s(6942),h=s(2297),u=s(3718),p=s(3766),b=s(9525);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,s(4297).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var j=s(1352);let v=[{value:"national_general",label:"National General"},{value:"progressive",label:"Progressive"},{value:"grange",label:"Grange"},{value:"safeco",label:"Safeco"},{value:"travelers",label:"Travelers"},{value:"geico",label:"Geico"},{value:"first_connect",label:"First Connect"},{value:"universal",label:"Universal"},{value:"nbs",label:"NBS / Bridge Specialty"},{value:"hartford",label:"Hartford"},{value:"other",label:"Other"}];function f(){var e;let{user:t,loading:s}=(0,r.a)(),b=(0,i.useRouter)(),[g,j]=(0,l.useState)([]),[f,y]=(0,l.useState)(null),[_,w]=(0,l.useState)(null),[C,S]=(0,l.useState)(null),[D,F]=(0,l.useState)(!1),[L,M]=(0,l.useState)("national_general"),[T,$]=(0,l.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[Z,A]=(0,l.useState)(!1),[U,z]=(0,l.useState)(null),[R,E]=(0,l.useState)("summary"),[X,B]=(0,l.useState)(null),[O,H]=(0,l.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[I,q]=(0,l.useState)(!1),[G,V]=(0,l.useState)(!1);(0,l.useEffect)(()=>{var e;s||t?t&&(null===(e=t.role)||void 0===e?void 0:e.toLowerCase())!=="admin"?b.push("/dashboard"):t&&Y():b.push("/")},[t,s]);let Y=async()=>{try{let e=await d.X1.list();j(e.data)}catch(e){console.error("Failed to load imports:",e)}},K=async e=>{var t,s,a,l,i,r;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;let c=g.find(e=>e.carrier===L&&e.period===T);if(c){let t=(null===(s=v.find(e=>e.value===L))||void 0===s?void 0:s.label)||L;if(!confirm("".concat(t," has already been uploaded for ").concat(T," (").concat(c.total_rows," rows, ").concat(c.matched_rows," matched).\n\nThis will create a second import. Continue?"))){e.target.value="";return}}A(!0);try{let e=await d.X1.upload(L,T,n);if(e.data.carrier_overridden){let t=(null===(a=v.find(t=>t.value===e.data.carrier_detected))||void 0===a?void 0:a.label)||e.data.carrier_detected,s=(null===(l=v.find(t=>t.value===e.data.carrier_selected))||void 0===l?void 0:l.label)||e.data.carrier_selected;alert("Auto-detected: File looks like ".concat(t," (you selected ").concat(s,"). Used ").concat(t," parser."))}await Y(),y(e.data.id),J(e.data.id)}catch(e){alert((null===(r=e.response)||void 0===r?void 0:null===(i=r.data)||void 0===i?void 0:i.detail)||"Upload failed")}finally{A(!1),e.target.value=""}},J=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];F(!0),t||S(null);try{let t=await d.X1.get(e);w(t.data)}catch(e){console.error("Failed to load detail:",e)}finally{F(!1)}},Q=async e=>{z("match");try{let t=await d.X1.match(e),s="Matched: ".concat(t.data.matched," total (").concat(t.data.newly_matched||0," new), Unmatched: ").concat(t.data.unmatched);alert(s),await Y(),await J(e)}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.detail)||"Matching failed")}finally{z(null)}},W=async(e,t)=>{if(t.stopPropagation(),confirm("Delete this import and all its matched lines? This cannot be undone."))try{await d.X1.delete(e),f===e&&(y(null),w(null),S(null)),await Y()}catch(e){var s,a;alert((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.detail)||"Delete failed")}},ee=async e=>{z("calculate");try{let t=await d.X1.calculate(e);S(t.data),E("agents"),await J(e,!0)}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.detail)||"Calculation failed")}finally{z(null)}};return s||!t||(null===(e=t.role)||void 0===e?void 0:e.toLowerCase())!=="admin"?null:(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,a.jsx)(n.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"font-display text-4xl font-bold text-slate-900 mb-2",children:"Commission Reconciliation"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Upload carrier statements, match to policies, and calculate agent commissions"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[(0,a.jsx)("h2",{className:"font-display text-xl font-bold text-slate-900 mb-4",children:"Upload Statement"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Carrier"}),(0,a.jsx)("select",{value:L,onChange:e=>M(e.target.value),className:"w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:v.map(e=>{let t=g.find(t=>t.carrier===e.value&&t.period===T);return(0,a.jsxs)("option",{value:e.value,children:[t?"✓  ":"    ",e.label,t?" (uploaded)":""]},e.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Statement Period"}),(0,a.jsx)("input",{type:"month",value:T,onChange:e=>$(e.target.value),className:"w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg cursor-pointer transition-colors",children:[(0,a.jsx)(c.Z,{size:18}),(0,a.jsx)("span",{children:Z?"Uploading...":"Upload File"}),(0,a.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls,.pdf",onChange:K,className:"hidden",disabled:Z})]})})]}),(()=>{var e;let t=g.find(e=>e.carrier===L&&e.period===T);if(!t)return null;let s=(null===(e=v.find(e=>e.value===L))||void 0===e?void 0:e.label)||L;return(0,a.jsxs)("div",{className:"mt-4 flex items-start space-x-3 bg-amber-50 border border-amber-200 rounded-lg px-4 py-3",children:[(0,a.jsx)(o.Z,{size:20,className:"text-amber-500 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-semibold text-amber-800",children:[s," already uploaded for ",T]}),(0,a.jsxs)("p",{className:"text-sm text-amber-700 mt-0.5",children:[t.total_rows," rows \xb7 ",t.matched_rows," matched \xb7 ",t.status.replace("_"," ")]}),(0,a.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"Uploading again will create a second import. Delete the existing one first if you want to replace it."})]})]})})(),g.filter(e=>e.period===T).length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[(0,a.jsxs)("p",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2",children:["Uploaded for ",T]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:v.filter(e=>"other"!==e.value&&"hartford"!==e.value).map(e=>{let t=g.find(t=>t.carrier===e.value&&t.period===T);return(0,a.jsxs)("span",{className:"inline-flex items-center space-x-1.5 px-2.5 py-1 rounded-full text-xs font-medium ".concat(t?"bg-green-50 text-green-700 border border-green-200":"bg-slate-50 text-slate-400 border border-slate-200"),children:[t?(0,a.jsx)(x.Z,{size:13}):(0,a.jsx)("span",{className:"w-3.5 h-3.5 rounded-full border border-slate-300 inline-block"}),(0,a.jsx)("span",{children:e.label})]},e.value)})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-display text-xl font-bold text-slate-900",children:"Monthly Agent Pay"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Combined commission across all carriers for the month"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"month",value:O,onChange:e=>H(e.target.value),className:"border border-slate-300 rounded-lg px-3 py-2 text-sm"}),(0,a.jsxs)("button",{onClick:async()=>{q(!0),V(!0);try{let e=await d.X1.monthlyPay(O);B(e.data)}catch(s){var e,t;alert((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||"Failed to calculate")}finally{q(!1)}},disabled:I,className:"inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg text-sm disabled:opacity-50",children:[(0,a.jsx)(m.Z,{size:16}),(0,a.jsx)("span",{children:I?"Calculating...":"Calculate Monthly Pay"})]})]})]}),G&&X&&!I&&(0,a.jsx)(P,{data:X}),G&&I&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(h.Z,{size:24,className:"mx-auto animate-spin text-green-600 mb-2"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Calculating combined pay..."})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-900 mb-3",children:"Imports"}),0===g.length?(0,a.jsx)("p",{className:"text-sm text-slate-500 text-center py-8",children:"No imports yet"}):(0,a.jsx)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:g.map(e=>(0,a.jsxs)("button",{onClick:()=>{y(e.id),J(e.id)},className:"w-full text-left p-3 rounded-lg border transition-all ".concat(f===e.id?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-slate-300"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-slate-900 truncate",children:e.carrier.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,a.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,a.jsx)(k,{status:e.status}),(0,a.jsx)("span",{onClick:t=>W(e.id,t),className:"text-slate-400 hover:text-red-500 transition-colors p-0.5",title:"Delete import",children:(0,a.jsx)(u.Z,{size:14})})]})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[e.period," \xb7 ",e.total_rows," rows"]}),(0,a.jsx)("div",{className:"text-xs text-slate-500 truncate",children:e.filename}),e.matched_rows>0&&(0,a.jsxs)("div",{className:"flex space-x-3 mt-1 text-xs",children:[(0,a.jsxs)("span",{className:"text-green-600",children:[e.matched_rows," matched"]}),e.unmatched_rows>0&&(0,a.jsxs)("span",{className:"text-amber-600",children:[e.unmatched_rows," unmatched"]})]})]},e.id))})]})}),(0,a.jsx)("div",{className:"lg:col-span-2",children:f?D?(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[(0,a.jsx)(h.Z,{size:32,className:"mx-auto mb-4 animate-spin text-blue-600"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Loading..."})]}):_?(0,a.jsx)(N,{data:_,agentSummary:C,activeTab:R,setActiveTab:E,onMatch:()=>Q(f),onCalculate:()=>ee(f),actionLoading:U}):null:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center text-slate-500",children:[(0,a.jsx)(p.Z,{size:48,className:"mx-auto mb-4 opacity-40"}),(0,a.jsx)("p",{children:"Select an import or upload a new statement to get started"})]})})]})]})]})}let N=e=>{let{data:t,agentSummary:s,activeTab:l,setActiveTab:i,onMatch:r,onCalculate:n,actionLoading:d}=e,c=t.import;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-slate-900",children:c.filename}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:[c.carrier.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())," \xb7 ",c.period]})]}),(0,a.jsx)(k,{status:c.status})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 mb-4",children:[(0,a.jsx)(C,{label:"Total Rows",value:c.total_rows}),(0,a.jsx)(C,{label:"Matched",value:c.matched_rows,color:"green"}),(0,a.jsx)(C,{label:"Unmatched",value:c.unmatched_rows,color:c.unmatched_rows>0?"amber":"green"}),(0,a.jsx)(C,{label:"Total Premium",value:"$".concat(c.total_premium.toLocaleString())}),(0,a.jsx)(C,{label:"Total Commission",value:"$".concat(c.total_commission.toLocaleString())})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsxs)("button",{onClick:r,disabled:"match"===d,className:"inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg text-sm transition-colors disabled:opacity-50",children:[(0,a.jsx)(h.Z,{size:16}),(0,a.jsx)("span",{children:"match"===d?"Matching...":c.matched_rows>0?"Re-Match Policies":"Run Auto-Match"})]}),c.matched_rows>0&&(0,a.jsxs)("button",{onClick:n,disabled:"calculate"===d,className:"inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg text-sm transition-colors disabled:opacity-50",children:[(0,a.jsx)(m.Z,{size:16}),(0,a.jsx)("span",{children:"calculate"===d?"Calculating...":"Calculate Agent Pay"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[(0,a.jsx)("div",{className:"flex border-b border-slate-200",children:[{key:"summary",label:"Summary",icon:p.Z},{key:"matched",label:"Matched (".concat(t.matched_lines.length,")"),icon:x.Z},{key:"unmatched",label:"Unmatched (".concat(t.unmatched_lines.length,")"),icon:o.Z},{key:"agents",label:"Agent Pay",icon:b.Z}].map(e=>{let{key:t,label:s,icon:r}=e;return(0,a.jsxs)("button",{onClick:()=>i(t),className:"flex items-center space-x-1.5 px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat(l===t?"border-blue-600 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,a.jsx)(r,{size:14}),(0,a.jsx)("span",{children:s})]},t)})}),(0,a.jsxs)("div",{className:"p-4",children:["summary"===l&&(0,a.jsx)(y,{data:t}),"matched"===l&&(0,a.jsx)(_,{lines:t.matched_lines,showAgent:!0}),"unmatched"===l&&(0,a.jsx)(_,{lines:t.unmatched_lines}),"agents"===l&&(0,a.jsx)(w,{summary:s})]})]})]})},y=e=>{let{data:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-900 mb-3",children:"Transaction Type Breakdown"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)("th",{className:"text-left py-2 px-3 font-semibold text-slate-700",children:"Type"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-slate-700",children:"Count"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-slate-700",children:"Premium"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-slate-700",children:"Commission"})]})}),(0,a.jsx)("tbody",{children:Object.entries(t.type_summary).sort((e,t)=>{let[,s]=e,[,a]=t;return Math.abs(a.premium)-Math.abs(s.premium)}).map(e=>{let[t,s]=e;return(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"py-2 px-3 font-medium",children:t}),(0,a.jsx)("td",{className:"py-2 px-3 text-right",children:s.count}),(0,a.jsxs)("td",{className:"py-2 px-3 text-right ".concat(s.premium<0?"text-red-600":""),children:["$",s.premium.toLocaleString(void 0,{minimumFractionDigits:2})]}),(0,a.jsxs)("td",{className:"py-2 px-3 text-right ".concat(s.commission<0?"text-red-600":""),children:["$",s.commission.toLocaleString(void 0,{minimumFractionDigits:2})]})]},t)})})]})})]})},_=e=>{var t;let{lines:s,showAgent:i}=e,[r,n]=(0,l.useState)(""),d=s.filter(e=>{var t,s,a;return(null===(t=e.policy_number)||void 0===t?void 0:t.toLowerCase().includes(r.toLowerCase()))||(null===(s=e.insured_name)||void 0===s?void 0:s.toLowerCase().includes(r.toLowerCase()))||(null===(a=e.producer_name)||void 0===a?void 0:a.toLowerCase().includes(r.toLowerCase()))});return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("input",{type:"text",placeholder:"Search by policy, name, or producer...",value:r,onChange:e=>n(e.target.value),className:"w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"})}),0===d.length?(0,a.jsx)("p",{className:"text-center text-slate-500 py-8",children:"No records found"}):(0,a.jsx)("div",{className:"overflow-x-auto max-h-[500px] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-700",children:"Policy #"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-700",children:"Insured"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-700",children:"Type"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-slate-700",children:"Premium"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-slate-700",children:"Comm"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-slate-700",children:"Rate"}),(null===(t=s[0])||void 0===t?void 0:t.producer_name)&&(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-700",children:"Producer"}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-700",children:"Agent"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-slate-700",children:"Agent Pay"})]})]})}),(0,a.jsx)("tbody",{children:d.map(e=>{var t,l,r;return(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"py-1.5 px-2 font-mono text-xs",children:e.policy_number}),(0,a.jsx)("td",{className:"py-1.5 px-2 max-w-[160px] truncate",children:e.insured_name}),(0,a.jsx)("td",{className:"py-1.5 px-2",children:(0,a.jsx)(S,{type:e.transaction_type_raw||e.transaction_type})}),(0,a.jsxs)("td",{className:"py-1.5 px-2 text-right font-mono ".concat(e.premium_amount<0?"text-red-600":""),children:["$",(null===(t=e.premium_amount)||void 0===t?void 0:t.toLocaleString(void 0,{minimumFractionDigits:2}))||"0.00"]}),(0,a.jsxs)("td",{className:"py-1.5 px-2 text-right font-mono ".concat(e.commission_amount<0?"text-red-600":""),children:["$",(null===(l=e.commission_amount)||void 0===l?void 0:l.toLocaleString(void 0,{minimumFractionDigits:2}))||"0.00"]}),(0,a.jsx)("td",{className:"py-1.5 px-2 text-right",children:e.commission_rate?"".concat((100*e.commission_rate).toFixed(0),"%"):"—"}),(null===(r=s[0])||void 0===r?void 0:r.producer_name)&&(0,a.jsx)("td",{className:"py-1.5 px-2 text-xs",children:e.producer_name}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"py-1.5 px-2 text-xs",children:e.assigned_agent||"—"}),(0,a.jsx)("td",{className:"py-1.5 px-2 text-right font-mono text-green-700",children:null!=e.agent_commission?"$".concat(e.agent_commission.toFixed(2)):"—"})]})]},e.id)})})]})})]})},w=e=>{let{summary:t}=e;return t?(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-slate-600 mb-1",children:["Rates based on ",(0,a.jsx)("span",{className:"font-semibold",children:t.tier_based_on||t.prior_period})," written premium"]}),t.note&&(0,a.jsx)("p",{className:"text-xs text-amber-600 mb-4",children:t.note}),(0,a.jsxs)("div",{className:"space-y-4",children:[t.agent_summaries.map(e=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold text-slate-900",children:e.agent_name}),(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["Tier ",e.tier_level," \xb7 ",(100*e.commission_rate).toFixed(1),"% rate \xb7"," ",e.line_count," transactions"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-green-700",children:["$",(e.total_agent_commission||0).toLocaleString(void 0,{minimumFractionDigits:2})]}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"agent commission"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Prior Month Premium: "}),(0,a.jsxs)("span",{className:"font-semibold",children:["$",(e.prior_month_premium||0).toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"This Month Premium: "}),(0,a.jsxs)("span",{className:"font-semibold",children:["$",(e.total_premium||0).toLocaleString()]})]})]})]},e.agent_id)),0===t.agent_summaries.length&&(0,a.jsx)("p",{className:"text-center text-slate-500 py-4",children:"No matched policies with assigned agents found. Run matching first."})]})]}):(0,a.jsxs)("div",{className:"text-center text-slate-500 py-8",children:[(0,a.jsx)(m.Z,{size:40,className:"mx-auto mb-3 opacity-40"}),(0,a.jsx)("p",{children:'Click "Calculate Agent Pay" to see agent commission breakdown'})]})},k=e=>{let{status:t}=e,s={uploaded:"bg-slate-100 text-slate-700",processing:"bg-yellow-100 text-yellow-700",processed:"bg-blue-100 text-blue-700",reconciled:"bg-green-100 text-green-700",approved:"bg-emerald-100 text-emerald-700",failed:"bg-red-100 text-red-700"};return(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full ".concat(s[t]||s.uploaded),children:t})},C=e=>{let{label:t,value:s,color:l}=e;return(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-2 text-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold ".concat("green"===l?"text-green-700":"amber"===l?"text-amber-700":"text-slate-900"),children:s}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:t})]})},S=e=>{let{type:t}=e;if(!t)return(0,a.jsx)("span",{className:"text-slate-400",children:"—"});let s=t.toLowerCase(),l="bg-slate-100 text-slate-600";return s.includes("new")?l="bg-green-100 text-green-700":s.includes("renew")?l="bg-blue-100 text-blue-700":s.includes("cancel")?l="bg-red-100 text-red-700":(s.includes("endors")||s.includes("revis"))&&(l="bg-yellow-100 text-yellow-700"),(0,a.jsx)("span",{className:"text-xs font-medium px-1.5 py-0.5 rounded ".concat(l),children:t.length>15?t.slice(0,15)+"…":t})},P=e=>{let{data:t}=e,s=e=>(null!=e?e:0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),[i,r]=(0,l.useState)(null),[n,d]=(0,l.useState)({}),[c,o]=(0,l.useState)({}),x=e=>n[e]||0,m=(e,t)=>{d(s=>({...s,[e]:t}))},h=e=>c[e]||0,u=(e,t)=>{o(s=>({...s,[e]:t}))},p=e=>{let t=x(e.agent_id),s=h(e.agent_id),a=e.net_agent_commission||e.total_agent_commission;if(0===t)return a+s;let l=e.commission_rate;return l?a/l*(l+t)+s:a+s};return(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[t.note&&(0,a.jsx)("p",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-1.5 rounded-lg",children:t.note}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-slate-900",children:t.totals.total_carriers}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Carriers"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-slate-900",children:t.totals.total_matched_lines}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Matched Lines"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-slate-900",children:["$",s(t.totals.total_premium)]}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Total Premium"})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-green-700",children:["$",s(t.totals.total_agent_pay)]}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Total Agent Pay"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-700 text-sm mb-2",children:"Carriers Included"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.carriers.map(e=>(0,a.jsxs)("span",{className:"text-xs bg-slate-100 text-slate-700 px-2.5 py-1 rounded-full font-medium",children:[e.carrier.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),(0,a.jsxs)("span",{className:"text-slate-400 ml-1",children:["(",e.matched_rows," matched)"]})]},e.carrier))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold text-slate-700 text-sm mb-2",children:["Agent Commission Breakdown — ",(0,a.jsx)("span",{className:"text-blue-600 font-normal",children:"click an agent for full detail & PDF"})]}),(0,a.jsx)("div",{className:"space-y-3",children:t.agent_summaries.map(e=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4 hover:border-green-300 hover:shadow-sm transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold text-slate-900",children:e.agent_name}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["retention_specialist"===e.agent_role?"Retention Specialist":"Producer"," \xb7 Tier ",e.tier_level," \xb7 ",((e.commission_rate+x(e.agent_id))*100).toFixed(1),"% \xb7 ",e.line_count," lines"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-green-700",children:["$",s(p(e))]}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"net agent pay"}),0!==x(e.agent_id)&&(0,a.jsxs)("div",{className:"text-xs mt-0.5 ".concat(x(e.agent_id)>0?"text-blue-600":"text-orange-600"),children:[x(e.agent_id)>0?"+":"",(100*x(e.agent_id)).toFixed(1),"% manual adjustment"]}),h(e.agent_id)>0&&(0,a.jsxs)("div",{className:"text-xs mt-0.5 text-purple-600",children:["+$",s(h(e.agent_id))," bonus"]}),e.chargeback_count>0&&(0,a.jsxs)("div",{className:"text-xs text-red-600 mt-0.5",children:["incl. $",s(Math.abs(e.chargeback_premium||e.chargebacks))," premium in chargebacks (",e.chargeback_count,")"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-100 flex-wrap",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500 mr-1",children:"Rate Override:"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),m(e.agent_id,-.005)},className:"px-2.5 py-1 text-xs rounded font-medium transition-all ".concat(-.005===x(e.agent_id)?"bg-orange-100 text-orange-700 ring-1 ring-orange-300":"bg-slate-100 text-slate-500 hover:bg-slate-200"),children:"−0.5%"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),m(e.agent_id,0)},className:"px-2.5 py-1 text-xs rounded font-medium transition-all ".concat(0===x(e.agent_id)?"bg-green-100 text-green-700 ring-1 ring-green-300":"bg-slate-100 text-slate-500 hover:bg-slate-200"),children:"Default"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),m(e.agent_id,.005)},className:"px-2.5 py-1 text-xs rounded font-medium transition-all ".concat(.005===x(e.agent_id)?"bg-blue-100 text-blue-700 ring-1 ring-blue-300":"bg-slate-100 text-slate-500 hover:bg-slate-200"),children:"+0.5%"}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500",children:"Bonus:"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:h(e.agent_id)||"",placeholder:"0.00",onClick:e=>e.stopPropagation(),onChange:t=>{t.stopPropagation(),u(e.agent_id,parseFloat(t.target.value)||0)},className:"w-24 pl-5 pr-2 py-1 text-xs border border-slate-200 rounded focus:outline-none focus:ring-1 focus:ring-green-300 focus:border-green-300"})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto cursor-pointer",onClick:()=>r({id:e.agent_id,name:e.agent_name}),children:(0,a.jsxs)("table",{className:"w-full text-xs mt-2",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-100",children:[(0,a.jsx)("th",{className:"text-left py-1 pr-2 font-semibold text-slate-600",children:"Carrier"}),(0,a.jsx)("th",{className:"text-right py-1 px-2 font-semibold text-slate-600",children:"Lines"}),(0,a.jsx)("th",{className:"text-right py-1 px-2 font-semibold text-slate-600",children:"Premium"}),(0,a.jsx)("th",{className:"text-right py-1 px-2 font-semibold text-red-600",children:"Chargebacks"}),(0,a.jsx)("th",{className:"text-right py-1 pl-2 font-semibold text-green-700",children:"Agent Pay"})]})}),(0,a.jsx)("tbody",{children:e.carrier_breakdown.map(e=>(0,a.jsxs)("tr",{className:"border-b border-slate-50",children:[(0,a.jsx)("td",{className:"py-1 pr-2 capitalize",children:e.carrier.replace("_"," ")}),(0,a.jsx)("td",{className:"py-1 px-2 text-right",children:e.line_count}),(0,a.jsxs)("td",{className:"py-1 px-2 text-right",children:["$",s(e.premium)]}),(0,a.jsx)("td",{className:"py-1 px-2 text-right text-red-600",children:e.chargebacks&&e.chargebacks<0?"-$".concat(s(Math.abs(e.chargebacks))):"—"}),(0,a.jsxs)("td",{className:"py-1 pl-2 text-right font-semibold text-green-700",children:["$",s(e.agent_commission)]})]},e.carrier))})]})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-500 mt-2 pt-2 border-t border-slate-100 cursor-pointer",onClick:()=>r({id:e.agent_id,name:e.agent_name}),children:[(0,a.jsxs)("span",{children:["Tier based on: $",s(e.tier_premium)," written premium"]}),(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:"Click for full detail & PDF →"})]})]},e.agent_id))})]}),(0,a.jsx)(D,{period:t.period,rateAdjustments:n,bonuses:c}),i&&(0,a.jsx)(F,{period:t.period,agentId:i.id,agentName:i.name,rateAdjustment:x(i.id),bonus:h(i.id),onClose:()=>r(null)})]})},D=e=>{let{period:t,rateAdjustments:s={},bonuses:i={}}=e,[r,n]=(0,l.useState)(null),[c,o]=(0,l.useState)(!1),[x,m]=(0,l.useState)([]),[h,u]=(0,l.useState)(!1);(0,l.useEffect)(()=>{p()},[t]);let p=async()=>{try{let e=await d.Nb.detail(t);n(e.data)}catch(e){n(null)}},b=async()=>{try{let e=await d.Nb.history();m(e.data),u(!0)}catch(e){alert("Failed to load history")}},g=async()=>{if(confirm("Submit payroll for this period? This will lock the calculations.")){o(!0);try{let e={};new Set([...Object.keys(s).map(Number),...Object.keys(i).map(Number)]).forEach(t=>{let a=s[t]||0,l=i[t]||0;(0!==a||0!==l)&&(e[String(t)]={rate_adjustment:a,bonus:l})}),await d.Nb.submit(t,e),alert("Payroll submitted and locked!"),p()}catch(t){var e,a;alert((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.detail)||"Failed to submit payroll")}finally{o(!1)}}},j=async()=>{if(confirm("Mark all agent commissions as PAID for this period?")){o(!0);try{await d.Nb.markPaid(t),alert("Payroll marked as paid! Sales updated to Commission Paid."),p()}catch(t){var e,s;alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)||"Failed to mark paid")}finally{o(!1)}}},v=async()=>{if(confirm("Unlock this payroll for re-calculation? (Admin override)")){o(!0);try{await d.Nb.unlock(t),alert("Payroll unlocked."),p()}catch(t){var e,s;alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)||"Failed to unlock")}finally{o(!1)}}},f=e=>(null!=e?e:0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return(0,a.jsxs)("div",{className:"border-t border-slate-200 pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[r?(0,a.jsxs)("span",{className:"text-sm font-semibold px-3 py-1 rounded-full ".concat("paid"===r.status?"bg-green-100 text-green-700":"submitted"===r.status?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600"),children:["Payroll: ",r.status.charAt(0).toUpperCase()+r.status.slice(1),r.is_locked&&" \uD83D\uDD12"]}):(0,a.jsx)("span",{className:"text-sm text-slate-500",children:"Payroll not yet submitted"}),(null==r?void 0:r.submitted_at)&&(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:["Submitted ",new Date(r.submitted_at).toLocaleDateString()]}),(null==r?void 0:r.paid_at)&&(0,a.jsxs)("span",{className:"text-xs text-green-600",children:["Paid ",new Date(r.paid_at).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:b,className:"text-xs text-blue-600 hover:underline",children:"View Payroll History"}),(!r||!r.is_locked)&&(0,a.jsx)("button",{onClick:g,disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg disabled:opacity-50",children:c?"Processing...":"\uD83D\uDCCB Submit Payroll"}),(null==r?void 0:r.status)==="submitted"&&(0,a.jsx)("button",{onClick:j,disabled:c,className:"bg-green-600 hover:bg-green-700 text-white text-sm font-semibold px-4 py-2 rounded-lg disabled:opacity-50",children:c?"Processing...":"\uD83D\uDCB0 Mark as Paid"}),(null==r?void 0:r.is_locked)&&(0,a.jsx)("button",{onClick:v,disabled:c,className:"bg-amber-500 hover:bg-amber-600 text-white text-sm font-semibold px-3 py-2 rounded-lg disabled:opacity-50",title:"Admin override — unlock for re-calculation",children:"\uD83D\uDD13 Unlock"})]})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>u(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[(0,a.jsx)("h3",{className:"font-bold text-lg text-slate-900",children:"Payroll History"}),(0,a.jsx)("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-slate-600 text-xl",children:"✕"})]}),(0,a.jsx)("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:0===x.length?(0,a.jsx)("p",{className:"text-center text-slate-500 py-8",children:"No payroll records yet"}):(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-3 font-semibold text-slate-600",children:"Period"}),(0,a.jsx)("th",{className:"text-center py-2 px-3 font-semibold text-slate-600",children:"Status"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-slate-600",children:"Agents"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-slate-600",children:"Total Premium"}),(0,a.jsx)("th",{className:"text-right py-2 px-3 font-semibold text-green-700",children:"Agent Pay"}),(0,a.jsx)("th",{className:"text-center py-2 px-3 font-semibold text-slate-600",children:"Submitted"}),(0,a.jsx)("th",{className:"text-center py-2 px-3 font-semibold text-slate-600",children:"Paid"})]})}),(0,a.jsx)("tbody",{children:x.map(e=>(0,a.jsxs)("tr",{className:"border-t border-slate-100",children:[(0,a.jsx)("td",{className:"py-2 px-3 font-medium",children:e.period_display||e.period}),(0,a.jsx)("td",{className:"py-2 px-3 text-center",children:(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full ".concat("paid"===e.status?"bg-green-100 text-green-700":"submitted"===e.status?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600"),children:e.status})}),(0,a.jsx)("td",{className:"py-2 px-3 text-right",children:e.total_agents}),(0,a.jsxs)("td",{className:"py-2 px-3 text-right",children:["$",f(e.total_premium)]}),(0,a.jsxs)("td",{className:"py-2 px-3 text-right font-semibold text-green-700",children:["$",f(e.total_agent_pay)]}),(0,a.jsx)("td",{className:"py-2 px-3 text-center text-xs",children:e.submitted_at?new Date(e.submitted_at).toLocaleDateString():"—"}),(0,a.jsx)("td",{className:"py-2 px-3 text-center text-xs",children:e.paid_at?new Date(e.paid_at).toLocaleDateString():"—"})]},e.id))})]})})]})})]})},F=e=>{var t,s,i,r,n,c,x,m,u,p,b;let{period:v,agentId:f,agentName:N,rateAdjustment:y=0,bonus:_=0,onClose:w}=e,[k,C]=(0,l.useState)(null),[S,P]=(0,l.useState)(!0),[D,F]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=!1;return(async()=>{P(!0),F(null);try{let t=await d.X1.agentSheet(v,f,y,_);e||C(t.data)}catch(a){if(!e){var t,s;F((null===(s=a.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.detail)||a.message||"Failed to load agent sheet")}}finally{e||P(!1)}})(),()=>{e=!0}},[v,f]);let L=e=>(null!=e?e:0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center z-50 p-4 overflow-y-auto",onClick:w,children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl my-8",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 bg-slate-50 rounded-t-xl",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"font-display text-xl font-bold text-slate-900",children:["Commission Sheet — ",N]}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:(null==k?void 0:k.period_display)||v})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[k&&(0,a.jsxs)("button",{onClick:()=>{let e=localStorage.getItem("token")||"",t=window.location.origin.replace("-web","-api").replace("better-choice-web","better-choice-api"),s="".concat(t).concat(d.X1.agentSheetPdfUrl(v,f)),a=new URLSearchParams;0!==y&&a.set("rate_adjustment",String(y)),0!==_&&a.set("bonus",String(_)),a.toString()&&(s+="?".concat(a.toString())),fetch(s,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.blob()).then(e=>{let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="Commission_".concat(N.replace(/ /g,"_"),"_").concat(v,".pdf"),t.click(),URL.revokeObjectURL(t.href)}).catch(e=>alert("PDF download failed: "+e.message))},className:"inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg text-sm",children:[(0,a.jsx)(g,{size:16}),(0,a.jsx)("span",{children:"Download PDF"})]}),(0,a.jsx)("button",{onClick:w,className:"text-slate-400 hover:text-slate-600",children:(0,a.jsx)(j.Z,{size:24})})]})]}),S?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(h.Z,{size:24,className:"mx-auto animate-spin text-green-600 mb-2"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Loading commission sheet..."})]}):D?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(o.Z,{size:32,className:"mx-auto text-red-500 mb-3"}),(0,a.jsx)("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load commission sheet"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:D}),(0,a.jsx)("button",{onClick:w,className:"mt-4 text-sm text-blue-600 hover:underline",children:"Close"})]}):k?(0,a.jsxs)("div",{className:"p-4 space-y-4 max-h-[75vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Role:"})," ",(0,a.jsx)("span",{className:"font-medium capitalize",children:(k.agent_role||"").replace("_"," ")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Tier:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:["Tier ",k.tier_level," (",(100*(k.commission_rate||0)).toFixed(1),"%)"]}),k.rate_adjustment&&0!==k.rate_adjustment&&(0,a.jsxs)("span",{className:"ml-1 text-xs font-semibold px-1.5 py-0.5 rounded ".concat(k.rate_adjustment>0?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"),children:[k.rate_adjustment>0?"+":"",(100*k.rate_adjustment).toFixed(1),"% adj"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Tier Premium:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:["$",L(k.tier_premium)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-slate-500",children:"Email:"})," ",(0,a.jsx)("span",{className:"font-medium",children:k.agent_email})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-800",children:["$",L(null===(t=k.summary)||void 0===t?void 0:t.new_business_premium)]}),(0,a.jsx)("div",{className:"text-xs text-blue-600",children:"New Business Premium"})]}),(0,a.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-slate-800",children:["$",L(null===(s=k.summary)||void 0===s?void 0:s.total_paid_premium)]}),(0,a.jsx)("div",{className:"text-xs text-slate-600",children:"Total Paid Premium"})]}),((null===(i=k.summary)||void 0===i?void 0:i.chargeback_count)||0)>0&&(0,a.jsxs)("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-red-700",children:["$",L(Math.abs((null===(r=k.summary)||void 0===r?void 0:r.chargeback_premium)||(null===(n=k.summary)||void 0===n?void 0:n.chargebacks)||0))]}),(0,a.jsxs)("div",{className:"text-xs text-red-600",children:["Chargebacks (",null===(c=k.summary)||void 0===c?void 0:c.chargeback_count,")"]})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-green-700",children:["$",L(null===(x=k.summary)||void 0===x?void 0:x.total_agent_commission)]}),(0,a.jsx)("div",{className:"text-xs text-green-600",children:"Commission"})]}),(k.bonus||0)>0&&(0,a.jsxs)("div",{className:"bg-purple-50 rounded-lg p-3 text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-purple-700",children:["$",L(k.bonus)]}),(0,a.jsx)("div",{className:"text-xs text-purple-600",children:"Bonus"})]}),(k.bonus||0)>0&&(0,a.jsxs)("div",{className:"bg-emerald-50 rounded-lg p-3 text-center ring-2 ring-emerald-200",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-emerald-700",children:["$",L(null===(m=k.summary)||void 0===m?void 0:m.grand_total)]}),(0,a.jsx)("div",{className:"text-xs text-emerald-600",children:"Grand Total"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold text-slate-700 text-sm mb-2",children:["Transaction Detail (",(null===(u=k.summary)||void 0===u?void 0:u.total_lines)||0," lines)"]}),(0,a.jsx)("div",{className:"overflow-x-auto border border-slate-200 rounded-lg",children:(0,a.jsxs)("table",{className:"w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-600",children:"Policy #"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-600",children:"Insured"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-600",children:"Carrier"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-600",children:"Trans Type"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-slate-600",children:"Premium"}),(0,a.jsx)("th",{className:"text-right py-2 px-2 font-semibold text-green-700",children:"Agent Comm"}),(0,a.jsx)("th",{className:"text-left py-2 px-2 font-semibold text-slate-600",children:"Notes"})]})}),(0,a.jsx)("tbody",{children:(k.line_items||[]).map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 ".concat(e.is_chargeback?"bg-red-50":t%2==0?"bg-white":"bg-slate-50/50"),children:[(0,a.jsx)("td",{className:"py-1.5 px-2 font-mono",children:e.policy_number}),(0,a.jsx)("td",{className:"py-1.5 px-2",children:e.insured_name||"—"}),(0,a.jsx)("td",{className:"py-1.5 px-2 capitalize",children:(e.carrier||"").replace("_"," ")}),(0,a.jsx)("td",{className:"py-1.5 px-2",children:e.transaction_type}),(0,a.jsxs)("td",{className:"py-1.5 px-2 text-right",children:["$",L(e.premium)]}),(0,a.jsxs)("td",{className:"py-1.5 px-2 text-right font-semibold ".concat(e.is_chargeback?"text-red-600":"text-green-700"),children:["$",L(e.agent_commission)]}),(0,a.jsx)("td",{className:"py-1.5 px-2 text-red-600",children:e.is_chargeback?"CHARGEBACK (".concat(e.term_months||"?","mo term)"):""})]},t))}),(0,a.jsx)("tfoot",{className:"bg-slate-100 border-t-2 border-slate-300",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{colSpan:4,className:"py-2 px-2 font-bold text-slate-700",children:"TOTALS"}),(0,a.jsxs)("td",{className:"py-2 px-2 text-right font-bold",children:["$",L(null===(p=k.summary)||void 0===p?void 0:p.new_business_premium)]}),(0,a.jsxs)("td",{className:"py-2 px-2 text-right font-bold text-green-700",children:["$",L(null===(b=k.summary)||void 0===b?void 0:b.total_agent_commission)]}),(0,a.jsx)("td",{})]})})]})})]})]}):null]})})}}},function(e){e.O(0,[597,228,888,774,179],function(){return e(e.s=6640)}),_N_E=e.O()}]);