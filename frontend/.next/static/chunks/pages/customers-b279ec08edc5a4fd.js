(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[525],{7653:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1853:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},4622:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},4979:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},6942:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},3217:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6953:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},4976:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},9769:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},2297:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},7764:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},2841:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},1352:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(4297).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9106:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customers",function(){return t(3199)}])},3199:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return M}});var a=t(5893),l=t(7294),n=t(1163),r=t(9835),i=t(3740),c=t(8856),d=t(4297);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,d.Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var x=t(7653);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,d.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var p=t(1853),u=t(3217),h=t(2297),b=t(9525),j=t(3766),f=t(6942),v=t(4622),g=t(7764);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,d.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var N=t(6953),w=t(9769),_=t(4976),k=t(4979),S=t(8971),Z=t(1352);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let z=(0,d.Z)("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]);var C=t(8142),D=t(2841),P=t(5077);function M(){var e;let{user:s,loading:t}=(0,r.a)(),d=(0,n.useRouter)(),[z,C]=(0,l.useState)([]),[D,P]=(0,l.useState)(0),[M,R]=(0,l.useState)(""),[F,U]=(0,l.useState)(!1),[q,J]=(0,l.useState)(!1),[O,H]=(0,l.useState)(1),[W,I]=(0,l.useState)(null),[V,X]=(0,l.useState)(!0),[$,B]=(0,l.useState)(null),[G,K]=(0,l.useState)(!1),[Q,Y]=(0,l.useState)(null),[ee,es]=(0,l.useState)(null),[et,ea]=(0,l.useState)(!1),[el,en]=(0,l.useState)(!1),[er,ei]=(0,l.useState)([]),[ec,ed]=(0,l.useState)(!1),[eo,ex]=(0,l.useState)(!1),[em,ep]=(0,l.useState)(!1),[eu,eh]=(0,l.useState)(!1),[eb,ej]=(0,l.useState)(null),[ef,ev]=(0,l.useState)(!0),[eg,ey]=(0,l.useState)([]),[eN,ew]=(0,l.useState)(!1),[e_,ek]=(0,l.useState)(!1),eS=(0,l.useRef)(null);(0,l.useEffect)(()=>{t||s?s&&(eZ(),ez()):d.push("/")},[s,t]);let eZ=async()=>{try{let e=await c.JP.nowcertsStatus();B(e.data)}catch(e){}},ez=async()=>{X(!0);try{let e=await c.JP.agencyStats();I(e.data)}catch(e){}X(!1)},eC=(0,l.useCallback)(async(e,s)=>{let t=null!=e?e:M;if(t.trim()){J(!0),U(!0);try{let e=await c.JP.search({q:t,source:"local",page:null!=s?s:O,page_size:50});C(e.data.customers||[]),P(e.data.total||0)}catch(e){}J(!1)}},[M,O]),eD=async e=>{let s=e.id||e.nowcerts_insured_id;if(Q===s){Y(null),es(null);return}if(Y(s),e.id){ea(!0);try{let s=await c.JP.get(e.id);es(s.data)}catch(e){}ea(!1)}},eP=async e=>{ea(!0);try{let s=await c.JP.sync(e);es(s.data)}catch(e){var s,t;alert((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.detail)||"Sync failed")}ea(!1)},eM=async()=>{if(confirm("Pull all customers from NowCerts? This may take a few minutes.")){K(!0);try{let e=await c.JP.syncAll();alert("Sync complete!\n".concat(e.data.imported," imported, ").concat(e.data.updated," updated\n").concat(e.data.policies_imported," policies imported, ").concat(e.data.policies_updated," policies updated")),ez()}catch(t){var e,s;alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)||"Sync failed")}K(!1)}},eE=async()=>{en(!0),ed(!0);try{let e=await c.JP.duplicates();ei(e.data.duplicate_sets||[])}catch(e){}ed(!1)},eL=async(e,s)=>{if(confirm("Merge ".concat(s.length," duplicate(s) into the selected customer? This cannot be undone."))){ex(!0);try{let t=await c.JP.merge(e,s);alert("Merged! ".concat(t.data.policies_moved," policies moved, ").concat(t.data.customers_deleted," duplicates removed.")),eE(),ez()}catch(e){var t,a;alert((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.detail)||"Merge failed")}ex(!1)}},eA=async()=>{ep(!0),ej(null),eT()},eT=async()=>{ew(!0);try{let e=await c.pR.history(10);ey(e.data.notices||[])}catch(e){}ew(!1)},eR=async e=>{var s,t,a,l,n;if(!["pdf","csv","tsv","txt","xlsx","xls"].includes((null===(s=e.name.split(".").pop())||void 0===s?void 0:s.toLowerCase())||"")){alert("Please upload a PDF, CSV, or Excel file.");return}eh(!0),ej(null);try{let s=await c.pR.upload(e,ef);ej(s.data),eT()}catch(s){console.error("Upload error full:",s),console.error("Response:",s.response),console.error("Request:",s.request),console.error("Config:",s.config);let e=(null===(a=s.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.detail)||(null===(n=s.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.message)||(s.response?"HTTP ".concat(s.response.status,": ").concat(JSON.stringify(s.response.data).slice(0,200)):"".concat(s.message," — Open browser console (F12) for details"));alert(e)}eh(!1)};if(t||!s)return null;let eF=(null===(e=s.role)||void 0===e?void 0:e.toLowerCase())==="admin",eU=e=>{var s;return null!==(s=null==e?void 0:e.toLocaleString("en-US"))&&void 0!==s?s:"0"};return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,a.jsx)(i.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-display text-3xl sm:text-4xl font-bold text-slate-900 mb-1",children:"Customers"}),(0,a.jsx)("p",{className:"text-slate-600 text-sm",children:"Agency customer directory"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[$&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-semibold ".concat($.connected?"bg-green-100 text-green-800":$.configured?"bg-red-100 text-red-800":"bg-slate-100 text-slate-500"),children:[$.connected?(0,a.jsx)(o,{size:14}):(0,a.jsx)(x.Z,{size:14}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"NowCerts"})," ",$.connected?"Connected":$.configured?"Auth Error":"Not Configured"]}),eF&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:eA,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-semibold bg-red-50 text-red-700 hover:bg-red-100 border border-red-200",children:[(0,a.jsx)(m,{size:14})," Non-Pay"]}),(0,a.jsxs)("button",{onClick:eE,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-semibold bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200",children:[(0,a.jsx)(p.Z,{size:14})," ",(0,a.jsx)("span",{className:"hidden sm:inline",children:"Duplicates"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Dups"})]}),(0,a.jsxs)("button",{onClick:eM,disabled:G,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-50",children:[G?(0,a.jsx)(u.Z,{size:14,className:"animate-spin"}):(0,a.jsx)(h.Z,{size:14}),(0,a.jsx)("span",{className:"hidden sm:inline",children:G?"Syncing...":"Sync All from NowCerts"}),(0,a.jsx)("span",{className:"sm:hidden",children:G?"Syncing...":"Sync All"})]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 mb-8",children:[(0,a.jsx)(E,{icon:(0,a.jsx)(b.Z,{size:18}),label:"Total Customers",value:V?"...":eU(null==W?void 0:W.total_customers),color:"blue"}),(0,a.jsx)(E,{icon:(0,a.jsx)(o,{size:18}),label:"Active Customers",value:V?"...":eU(null==W?void 0:W.active_customers),color:"green"}),(0,a.jsx)(E,{icon:(0,a.jsx)(j.Z,{size:18}),label:"Active Policies",value:V?"...":eU(null==W?void 0:W.active_policies),color:"indigo"}),(0,a.jsx)(E,{icon:(0,a.jsx)(f.Z,{size:18}),label:"Annual Premium",value:V?"...":"$"+((null==W?void 0:W.total_active_premium_annualized)||0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),color:"emerald"}),(0,a.jsx)(E,{icon:(0,a.jsx)(v.Z,{size:18}),label:"Last Sync",value:V?"...":(null==W?void 0:W.last_sync)?new Date(W.last_sync).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"Never",color:"slate"})]}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),H(1),eC(M,1)},className:"card p-3 sm:p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex gap-2 sm:gap-3",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(g.Z,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),(0,a.jsx)("input",{type:"text",value:M,onChange:e=>R(e.target.value),placeholder:"Search by name, email, phone number, or address",className:"w-full pl-10 pr-4 py-2.5 sm:py-3 rounded-lg border border-slate-200 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]}),(0,a.jsxs)("button",{type:"submit",disabled:!M.trim(),className:"btn-primary px-4 sm:px-6 py-2.5 sm:py-3 flex items-center gap-2 disabled:opacity-40",children:[(0,a.jsx)(g.Z,{size:16})," ",(0,a.jsx)("span",{className:"hidden sm:inline",children:"Search"})]})]})}),q?(0,a.jsxs)("div",{className:"text-center py-16 text-slate-500",children:[(0,a.jsx)(u.Z,{size:24,className:"animate-spin mx-auto mb-3"}),"Searching..."]}):F&&0===z.length?(0,a.jsxs)("div",{className:"text-center py-16 text-slate-500",children:[(0,a.jsx)(y,{size:32,className:"mx-auto mb-3 opacity-40"}),(0,a.jsx)("p",{className:"font-semibold",children:"No customers found"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Try a different search term"})]}):F?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-slate-500 mb-3",children:[eU(D)," result",1!==D?"s":""," for “",M,"”"]}),(0,a.jsx)("div",{className:"space-y-2",children:z.map((e,s)=>{var t,l,n,r,i,c,d,o,x,m,p,b;let j=e.id||e.nowcerts_insured_id||s,f=Q===j;return(0,a.jsxs)("div",{className:"card overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>eD(e),className:"w-full text-left p-3 sm:p-4 flex items-center justify-between hover:bg-slate-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0 ".concat(e.has_active_policy?"bg-green-100 text-green-700":"bg-slate-100 text-slate-500"),children:null===(t=(e.full_name||"?")[0])||void 0===t?void 0:t.toUpperCase()}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("p",{className:"font-bold text-slate-900 truncate text-sm sm:text-base",children:e.full_name}),e.has_active_policy?(0,a.jsx)("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-semibold",children:"Active"}):(0,a.jsx)("span",{className:"text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-semibold",children:"Inactive"}),e.is_prospect&&(0,a.jsx)("span",{className:"text-[10px] bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded font-semibold",children:"Prospect"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-0.5 sm:gap-4 text-xs text-slate-500 mt-0.5",children:[e.email&&(0,a.jsxs)("span",{className:"flex items-center gap-1 truncate",children:[(0,a.jsx)(N.Z,{size:11}),(0,a.jsx)("span",{className:"truncate",children:e.email})]}),e.phone&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(w.Z,{size:11}),e.phone]}),e.city&&e.state&&(0,a.jsxs)("span",{className:"flex items-center gap-1 hidden sm:flex",children:[(0,a.jsx)(_.Z,{size:11}),e.city,", ",e.state]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0 ml-2",children:[e.policy_count>0&&(0,a.jsxs)("span",{className:"text-xs text-slate-400 hidden sm:inline",children:[e.policy_count," ",1===e.policy_count?"policy":"policies"]}),f?(0,a.jsx)(k.Z,{size:18,className:"text-slate-400"}):(0,a.jsx)(S.Z,{size:18,className:"text-slate-400"})]})]}),f&&(0,a.jsx)("div",{className:"border-t border-slate-200 bg-slate-50 p-5",children:et?(0,a.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,a.jsx)(u.Z,{size:20,className:"animate-spin mx-auto mb-2"}),"Loading..."]}):ee?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-5",children:[(0,a.jsx)(L,{icon:(0,a.jsx)(y,{size:14}),label:"Name",value:null===(l=ee.customer)||void 0===l?void 0:l.full_name}),(0,a.jsx)(L,{icon:(0,a.jsx)(N.Z,{size:14}),label:"Email",value:null===(n=ee.customer)||void 0===n?void 0:n.email}),(0,a.jsx)(L,{icon:(0,a.jsx)(w.Z,{size:14}),label:"Phone",value:null===(r=ee.customer)||void 0===r?void 0:r.phone}),(0,a.jsx)(L,{icon:(0,a.jsx)(w.Z,{size:14}),label:"Mobile",value:null===(i=ee.customer)||void 0===i?void 0:i.mobile_phone}),(0,a.jsx)(L,{icon:(0,a.jsx)(_.Z,{size:14}),label:"Address",value:null===(c=ee.customer)||void 0===c?void 0:c.address}),(0,a.jsx)(L,{icon:(0,a.jsx)(_.Z,{size:14}),label:"City",value:(null===(d=ee.customer)||void 0===d?void 0:d.city)?"".concat(ee.customer.city,", ").concat(ee.customer.state," ").concat(ee.customer.zip_code):null}),(0,a.jsx)(L,{icon:(0,a.jsx)(y,{size:14}),label:"Agent",value:null===(o=ee.customer)||void 0===o?void 0:o.agent_name}),(0,a.jsx)(L,{icon:(0,a.jsx)(v.Z,{size:14}),label:"Last Synced",value:(null===(x=ee.customer)||void 0===x?void 0:x.last_synced_at)?new Date(ee.customer.last_synced_at).toLocaleDateString():"Never"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-900",children:["Policies (",(null===(m=ee.policies)||void 0===m?void 0:m.length)||0,")"]}),(null===(p=ee.customer)||void 0===p?void 0:p.id)&&(0,a.jsxs)("button",{onClick:()=>eP(ee.customer.id),className:"flex items-center gap-1.5 text-xs text-brand-600 hover:text-brand-700 font-semibold",children:[(0,a.jsx)(h.Z,{size:13}),"Refresh from NowCerts"]})]}),(null===(b=ee.policies)||void 0===b?void 0:b.length)>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-xs text-slate-500 border-b border-slate-200",children:[(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Policy #"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Carrier"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Type"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Status"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Effective"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Expires"}),(0,a.jsx)("th",{className:"pb-2 font-semibold text-right",children:"Premium"})]})}),(0,a.jsx)("tbody",{children:ee.policies.map((e,s)=>{var t,l;return(0,a.jsxs)("tr",{className:"border-b border-slate-100",children:[(0,a.jsx)("td",{className:"py-2.5 font-semibold text-slate-900",children:e.policy_number||"—"}),(0,a.jsx)("td",{className:"py-2.5",children:e.carrier||"—"}),(0,a.jsx)("td",{className:"py-2.5 capitalize",children:e.line_of_business||e.policy_type||"—"}),(0,a.jsx)("td",{className:"py-2.5",children:(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full font-semibold ".concat((null===(t=e.status)||void 0===t?void 0:t.toLowerCase())==="active"?"bg-green-100 text-green-700":(null===(l=e.status)||void 0===l?void 0:l.toLowerCase())==="cancelled"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"),children:e.status||"Unknown"})}),(0,a.jsx)("td",{className:"py-2.5",children:e.effective_date?new Date(e.effective_date).toLocaleDateString():"—"}),(0,a.jsx)("td",{className:"py-2.5",children:e.expiration_date?new Date(e.expiration_date).toLocaleDateString():"—"}),(0,a.jsx)("td",{className:"py-2.5 text-right font-semibold",children:e.premium?"$".concat(parseFloat(e.premium).toLocaleString()):"—"})]},e.id||s)})})]})}):(0,a.jsx)("p",{className:"text-sm text-slate-500 py-4 text-center",children:"No policies found. Try refreshing from NowCerts."})]}):null})]},j)})}),D>50&&(0,a.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>{H(e=>Math.max(1,e-1)),eC(M,Math.max(1,O-1))},disabled:O<=1,className:"px-3 py-1.5 text-sm rounded border border-slate-200 disabled:opacity-30",children:"Prev"}),(0,a.jsxs)("span",{className:"px-3 py-1.5 text-sm text-slate-500",children:["Page ",O," of ",Math.ceil(D/50)]}),(0,a.jsx)("button",{onClick:()=>{H(e=>e+1),eC(M,O+1)},disabled:50*O>=D,className:"px-3 py-1.5 text-sm rounded border border-slate-200 disabled:opacity-30",children:"Next"})]})]}):(0,a.jsxs)("div",{className:"text-center py-20 text-slate-400",children:[(0,a.jsx)(g.Z,{size:48,className:"mx-auto mb-4 opacity-30"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-slate-500",children:"Search for a customer"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Enter a name, email, phone number, or address"})]}),el&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Potential Duplicates"}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 mt-0.5",children:[er.length," group",1!==er.length?"s":""," found"]})]}),(0,a.jsx)("button",{onClick:()=>en(!1),className:"p-2 hover:bg-slate-100 rounded-lg",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-5 space-y-4",children:ec?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(u.Z,{size:24,className:"animate-spin mx-auto mb-3"}),"Scanning..."]}):0===er.length?(0,a.jsxs)("div",{className:"text-center py-12 text-slate-500",children:[(0,a.jsx)(o,{size:32,className:"mx-auto mb-3 text-green-500"}),(0,a.jsx)("p",{className:"font-semibold",children:"No duplicates found!"})]}):er.map((e,s)=>(0,a.jsx)(A,{group:e,onMerge:eL,merging:eo},s))})]})}),em&&(0,a.jsx)(T,{onClose:()=>ep(!1),uploading:eu,result:eb,history:eg,histLoading:eN,dragOver:e_,setDragOver:ek,onDrop:e=>{var s;e.preventDefault(),ek(!1);let t=null===(s=e.dataTransfer.files)||void 0===s?void 0:s[0];t&&eR(t)},onFileSelect:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&eR(t),e.target.value=""},fileInputRef:eS,dryRun:ef,setDryRun:ev})]})]})}let E=e=>{let{icon:s,label:t,value:l,color:n}=e,r={blue:"text-blue-600 bg-blue-50",green:"text-green-600 bg-green-50",indigo:"text-indigo-600 bg-indigo-50",emerald:"text-emerald-600 bg-emerald-50",slate:"text-slate-600 bg-slate-100"};return(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)("div",{className:"p-1.5 sm:p-2 rounded-lg ".concat(r[n]||r.slate),children:s})}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold text-slate-900 truncate",children:l}),(0,a.jsx)("p",{className:"text-[11px] sm:text-xs text-slate-500 mt-0.5",children:t})]})},L=e=>{let{icon:s,label:t,value:l}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mb-0.5",children:[s,t]}),(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-800",children:l||"—"})]})},A=e=>{let{group:s,onMerge:t,merging:n}=e,[r,i]=(0,l.useState)(null),c="name"===s.match_type?"Same Name":"phone"===s.match_type?"Same Phone":"Same Email",d=s.customers||[];return(0,a.jsxs)("div",{className:"border border-amber-200 rounded-xl bg-amber-50/50 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-semibold",children:c}),(0,a.jsxs)("span",{className:"text-sm text-slate-600 font-medium",children:["“",s.match_value,"”"]}),(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:["(",d.length," records)"]})]}),(0,a.jsxs)("button",{onClick:()=>{if(!r)return alert("Select which customer to keep.");t(r,d.map(e=>e.id).filter(e=>e!==r))},disabled:!r||n,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-40",children:[(0,a.jsx)(z,{size:13}),"Merge"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:d.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 rounded-lg border cursor-pointer ".concat(r===e.id?"border-brand-400 bg-brand-50":"border-slate-200 bg-white hover:border-slate-300"),children:[(0,a.jsx)("input",{type:"radio",name:"dup-".concat(s.match_value),checked:r===e.id,onChange:()=>i(e.id),className:"accent-brand-600"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-semibold text-sm text-slate-900",children:e.full_name}),e.has_active_policy&&(0,a.jsx)("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-semibold",children:"Active"}),(0,a.jsxs)("span",{className:"text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded",children:[e.policy_count," policies"]})]}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-slate-500 mt-0.5",children:[e.email&&(0,a.jsx)("span",{children:e.email}),e.phone&&(0,a.jsx)("span",{children:e.phone}),e.city&&e.state&&(0,a.jsxs)("span",{children:[e.city,", ",e.state]})]})]}),r===e.id&&(0,a.jsx)("span",{className:"text-xs font-semibold text-brand-600",children:"KEEP"})]},e.id))})]})},T=e=>{var s,t,n;let{onClose:r,uploading:i,result:d,history:o,histLoading:x,dragOver:m,setDragOver:p,onDrop:h,onFileSelect:b,fileInputRef:j,dryRun:f,setDryRun:v}=e,[g,y]=(0,l.useState)("upload"),[w,_]=(0,l.useState)([]),[k,S]=(0,l.useState)(""),[z,M]=(0,l.useState)(""),[E,L]=(0,l.useState)(""),[A,T]=(0,l.useState)(!1),[R,F]=(0,l.useState)(""),[U,q]=(0,l.useState)(!1),J=async()=>{try{var e;let s=await c.pR.carriers();_(s.data.carriers||[]),(null===(e=s.data.carriers)||void 0===e?void 0:e.length)&&!k&&S(s.data.carriers[0].key)}catch(e){}},O=async e=>{T(!0);try{let s=await c.pR.preview({carrier:e,client_name:"John Smith",policy_number:"AUT-12345678",amount_due:247.5,due_date:"02/28/2026"});M(s.data.html||""),L(s.data.subject||"")}catch(e){}T(!1)};return(0,l.useEffect)(()=>{"preview"===g&&0===w.length&&J()},[g]),(0,l.useEffect)(()=>{"preview"===g&&k&&O(k)},[k,g]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Non-Pay Automation"}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mt-0.5",children:"Upload notices or preview email templates"})]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-slate-100 rounded-lg",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"flex border-b border-slate-200 px-5",children:[(0,a.jsxs)("button",{onClick:()=>y("upload"),className:"px-4 py-3 text-sm font-semibold border-b-2 transition-colors ".concat("upload"===g?"border-brand-500 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,a.jsx)(C.Z,{size:14,className:"inline mr-1.5 -mt-0.5"}),"Upload & Send"]}),(0,a.jsxs)("button",{onClick:()=>y("preview"),className:"px-4 py-3 text-sm font-semibold border-b-2 transition-colors ".concat("preview"===g?"border-brand-500 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,a.jsx)(N.Z,{size:14,className:"inline mr-1.5 -mt-0.5"}),"Preview Templates"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-5",children:"upload"===g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl mb-4 ".concat(f?"bg-amber-50 border border-amber-200":"bg-green-50 border border-green-200"),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-sm ".concat(f?"text-amber-800":"text-green-800"),children:f?"\uD83E\uDDEA Test Mode — No emails will be sent":"\uD83D\uDE80 Live Mode — Emails will be sent to customers"}),(0,a.jsx)("p",{className:"text-xs mt-0.5 ".concat(f?"text-amber-600":"text-green-600"),children:f?"Upload a file to preview which customers would be emailed":"Emails will go out to real customer addresses"})]}),(0,a.jsx)("button",{onClick:()=>v(!f),className:"relative inline-flex h-7 w-12 items-center rounded-full transition-colors ".concat(f?"bg-amber-400":"bg-green-500"),children:(0,a.jsx)("span",{className:"inline-block h-5 w-5 rounded-full bg-white shadow transform transition-transform ".concat(f?"translate-x-1":"translate-x-6")})})]}),(0,a.jsxs)("div",{onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:()=>p(!1),onDrop:h,onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ".concat(m?"border-brand-500 bg-brand-50":"border-slate-300 hover:border-slate-400 hover:bg-slate-50"," ").concat(i?"opacity-50 pointer-events-none":""),children:[(0,a.jsx)("input",{ref:j,type:"file",accept:".pdf,.csv,.tsv,.txt,.xlsx,.xls",onChange:b,className:"hidden"}),i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{size:36,className:"mx-auto mb-3 text-brand-500 animate-spin"}),(0,a.jsx)("p",{className:"font-semibold text-slate-700",children:"Processing file..."}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Extracting policies and sending emails"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{size:36,className:"mx-auto mb-3 text-slate-400"}),(0,a.jsx)("p",{className:"font-semibold text-slate-700",children:"Drop non-pay file here or click to browse"}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Supports PDF, CSV, and Excel files"})]})]}),(0,a.jsxs)("div",{className:"mt-4 p-4 bg-slate-50 rounded-xl text-sm text-slate-600",children:[(0,a.jsx)("p",{className:"font-semibold text-slate-700 mb-2",children:"How it works:"}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("p",{children:"1. Upload your carrier non-pay report (PDF or CSV)"}),(0,a.jsx)("p",{children:"2. System extracts policy numbers and matches to customers"}),(0,a.jsx)("p",{children:"3. Carrier-branded past-due emails sent automatically"}),(0,a.jsxs)("p",{children:["4. ",(0,a.jsx)("strong",{children:"Rate limit:"})," Max 1 email per policy per week"]})]})]}),d&&(0,a.jsxs)("div",{className:"mt-5 border rounded-xl overflow-hidden ".concat(d.dry_run?"border-amber-200":"border-slate-200"),children:[(0,a.jsx)("div",{className:"p-4 border-b ".concat(d.dry_run?"bg-amber-50 border-amber-200":"bg-slate-50 border-slate-200"),children:(0,a.jsx)("h3",{className:"font-bold text-slate-900",children:d.dry_run?"\uD83E\uDDEA Test Results — No emails were sent":"Processing Results"})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xl font-bold text-blue-700",children:d.policies_found}),(0,a.jsx)("p",{className:"text-xs text-blue-600",children:"Found"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xl font-bold text-green-700",children:d.policies_matched}),(0,a.jsx)("p",{className:"text-xs text-green-600",children:"Matched"})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg ".concat(d.dry_run?"bg-amber-50":"bg-emerald-50"),children:[(0,a.jsx)("p",{className:"text-xl font-bold ".concat(d.dry_run?"text-amber-700":"text-emerald-700"),children:d.dry_run?(null===(s=d.details)||void 0===s?void 0:s.filter(e=>e.would_send).length)||0:d.emails_sent}),(0,a.jsx)("p",{className:"text-xs ".concat(d.dry_run?"text-amber-600":"text-emerald-600"),children:d.dry_run?"Would Email":"Emailed"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xl font-bold text-purple-700",children:d.dry_run?(null===(t=d.details)||void 0===t?void 0:t.filter(e=>e.would_send_letter).length)||0:d.letters_sent||0}),(0,a.jsx)("p",{className:"text-xs text-purple-600",children:d.dry_run?"Would Mail":"Mailed"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-amber-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xl font-bold text-amber-700",children:d.emails_skipped}),(0,a.jsx)("p",{className:"text-xs text-amber-600",children:"Skipped"})]})]}),(null===(n=d.details)||void 0===n?void 0:n.length)>0&&(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-slate-500 border-b",children:[(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Policy"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Customer"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Reason"}),(0,a.jsx)("th",{className:"pb-2 font-semibold",children:"Status"})]})}),(0,a.jsx)("tbody",{children:d.details.map((e,s)=>(0,a.jsxs)("tr",{className:"border-b border-slate-100 ".concat(e.skipped_reason?"opacity-50":""),children:[(0,a.jsx)("td",{className:"py-2 font-mono font-semibold",children:e.policy_number}),(0,a.jsx)("td",{className:"py-2",children:e.insured_name||e.customer_name||(0,a.jsx)("span",{className:"text-slate-400",children:"—"})}),(0,a.jsx)("td",{className:"py-2 text-slate-500 text-[11px]",children:e.cancel_reason?(0,a.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium ".concat("non-pay"===e.notice_type?"bg-red-100 text-red-700":"underwriting"===e.notice_type?"bg-orange-100 text-orange-700":(e.notice_type,"bg-slate-100 text-slate-600")),children:e.cancel_reason}):e.customer_email||"—"}),(0,a.jsx)("td",{className:"py-2",children:e.skipped_reason?(0,a.jsx)("span",{className:"text-slate-400 italic",children:"Ignored"}):e.would_send?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-amber-600",children:["✓ Would email ",e.customer_email]}):e.would_send_letter?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-purple-600",children:["✉ Would mail letter to ",e.letter_address||"address on file"]}):e.email_sent?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-green-600",children:[(0,a.jsx)(D.Z,{size:11}),"Sent to ",e.customer_email]}):e.letter_sent?(0,a.jsx)("span",{className:"flex items-center gap-1 text-purple-600",children:"\uD83D\uDCEC Letter mailed via Thanks.io"}):e.skipped_rate_limit?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-amber-600",children:[(0,a.jsx)(P.Z,{size:11}),"Sent recently"]}):(0,a.jsx)("span",{className:"text-red-500",children:e.error||"Not matched"})})]},s))})]})})]})]}),(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("h3",{className:"font-bold text-slate-900 mb-3",children:"Recent Uploads"}),x?(0,a.jsx)("div",{className:"text-center py-6",children:(0,a.jsx)(u.Z,{size:18,className:"animate-spin mx-auto"})}):0===o.length?(0,a.jsx)("p",{className:"text-sm text-slate-500 text-center py-6",children:"No uploads yet"}):(0,a.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-800",children:e.filename}),(0,a.jsx)("span",{className:"text-slate-400 ml-2",children:e.uploaded_by})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[(0,a.jsxs)("span",{children:[e.policies_found," found"]}),(0,a.jsxs)("span",{className:"text-green-600",children:[e.emails_sent," sent"]}),e.emails_skipped>0&&(0,a.jsxs)("span",{className:"text-amber-600",children:[e.emails_skipped," skipped"]}),(0,a.jsx)("span",{children:e.created_at?new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):""})]})]},e.id))})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"w-56 flex-shrink-0",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-slate-500 mb-1.5 block",children:"Select Carrier"}),(0,a.jsxs)("select",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm focus:ring-2 focus:ring-brand-500",children:[(0,a.jsx)("option",{value:"",children:"Generic (No Carrier)"}),w.map(e=>(0,a.jsx)("option",{value:e.key,children:e.display_name},e.key))]}),(0,a.jsx)("p",{className:"text-[11px] text-slate-400 mt-1.5",children:"Sample data: John Smith, $247.50 due"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[E&&(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-slate-500",children:"Subject Line:"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-800 mt-0.5",children:E})]}),(0,a.jsx)("label",{className:"text-xs font-semibold text-slate-500 mb-1.5 block",children:"Send Test Email"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"email",value:R,onChange:e=>F(e.target.value),placeholder:"your@email.com",className:"flex-1 px-3 py-2 rounded-lg border border-slate-200 text-sm focus:ring-2 focus:ring-brand-500"}),(0,a.jsxs)("button",{onClick:async()=>{if(R){q(!0);try{let e=await c.pR.sendTest({to_email:R,carrier:k||""});e.data.success?alert("Test email sent to ".concat(R,"!")):alert("Failed: ".concat(e.data.error||"Unknown error"))}catch(t){var e,s;alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)||"Send failed")}q(!1)}},disabled:!R||U,className:"px-4 py-2 rounded-lg text-sm font-semibold bg-brand-600 text-white hover:bg-brand-700 disabled:opacity-40 flex items-center gap-1.5",children:[U?(0,a.jsx)(u.Z,{size:14,className:"animate-spin"}):(0,a.jsx)(D.Z,{size:14}),"Send"]})]})]})]}),A?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(u.Z,{size:24,className:"animate-spin mx-auto mb-3"}),"Loading preview..."]}):z?(0,a.jsx)("div",{className:"border border-slate-200 rounded-xl overflow-hidden",children:(0,a.jsx)("iframe",{srcDoc:z,className:"w-full border-0",style:{height:"600px"},title:"Email Preview",sandbox:"allow-same-origin"})}):(0,a.jsx)("div",{className:"text-center py-12 text-slate-500",children:"Select a carrier to preview the email template"})]})})]})})}}},function(e){e.O(0,[597,228,888,774,179],function(){return e(e.s=9106)}),_N_E=e.O()}]);