(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{1853:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(4297).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3756:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(4297).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4976:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(4297).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},2027:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(4297).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},3809:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timeclock",function(){return s(9250)}])},9250:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var l=s(5893),a=s(7294),n=s(1163),i=s(9835),c=s(3740),d=s(8856),x=s(9525),r=s(2027),o=s(9858),m=s(4297);/**
 * @license lucide-react v0.316.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,m.Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),u=(0,m.Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var p=s(4976),b=s(3756),j=s(9455),f=s(1853);function y(){var e,t;let{user:s,loading:o}=(0,i.a)(),m=(0,n.useRouter)(),[h,u]=(0,a.useState)(null),[p,b]=(0,a.useState)(null),[j,f]=(0,a.useState)(null),[y,_]=(0,a.useState)(null),[w,k]=(0,a.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),Z=(null==s?void 0:null===(e=s.role)||void 0===e?void 0:e.toLowerCase())==="admin"||(null==s?void 0:null===(t=s.role)||void 0===t?void 0:t.toLowerCase())==="manager",C=(0,a.useCallback)(async()=>{try{let e=await d.id.myHistory(w);b(e.data)}catch(e){console.error("Failed to load history:",e)}},[w]),z=(0,a.useCallback)(async()=>{if(Z)try{let e=await d.id.adminSummary(w);f(e.data)}catch(e){console.error("Failed to load admin summary:",e)}},[Z,w]);(0,a.useEffect)(()=>{o||s?s&&(C(),Z&&z()):m.push("/")},[s,o,w]);let E=async e=>{let t=prompt("Reason for excusing this late entry (optional):");try{if(await d.id.excuse(e,t||void 0),await C(),Z&&await z(),y){let e=await d.id.adminEmployeeDetail(y.user_id,w);_(e.data)}}catch(e){var s,l;alert((null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.detail)||"Failed to excuse")}},S=async e=>{try{if(await d.id.unexcuse(e),await C(),Z&&await z(),y){let e=await d.id.adminEmployeeDetail(y.user_id,w);_(e.data)}}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.detail)||"Failed")}},D=async e=>{try{let t=await d.id.adminEmployeeDetail(e,w);_(t.data)}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.detail)||"Failed to load")}};return o||!s?null:(0,l.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,l.jsx)(c.Z,{}),(0,l.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"font-display text-4xl font-bold text-slate-900 mb-2",children:"Attendance"}),(0,l.jsxs)("p",{className:"text-slate-600",children:["Your attendance history and commission impact — clock in/out from the ",(0,l.jsx)("a",{href:"/dashboard",className:"text-blue-600 hover:underline font-semibold",children:"Dashboard"})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-3 mb-6",children:(0,l.jsx)("input",{type:"month",value:w,onChange:e=>k(e.target.value),className:"border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"})}),(null==p?void 0:p.summary)&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[(0,l.jsx)("h3",{className:"font-display text-lg font-bold text-slate-900 mb-4",children:"My Attendance"}),(0,l.jsx)(N,{summary:p.summary})]}),(null==p?void 0:p.entries)&&p.entries.length>0&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[(0,l.jsx)("h3",{className:"font-display text-lg font-bold text-slate-900 mb-4",children:"My Clock History"}),(0,l.jsx)(g,{entries:p.entries,isAdmin:Z,onExcuse:E,onUnexcuse:S})]}),Z&&j&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,l.jsx)(x.Z,{size:20,className:"text-slate-400"}),(0,l.jsxs)("h3",{className:"font-display text-lg font-bold text-slate-900",children:["Team Attendance — ",w]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b border-slate-200 text-left",children:[(0,l.jsx)("th",{className:"py-2 pr-4 font-semibold text-slate-600",children:"Employee"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Days"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"On Time"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Late"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Excused"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Unexcused"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Hours"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Commission Impact"}),(0,l.jsx)("th",{className:"py-2 px-1"})]})}),(0,l.jsx)("tbody",{children:j.employees.map(e=>(0,l.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"py-2.5 pr-4 font-medium text-slate-900",children:e.name}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center text-slate-700",children:e.total_days}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center text-green-600 font-semibold",children:e.on_time_days}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center text-slate-700",children:e.late_days}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center text-blue-600",children:e.excused_days}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center font-bold",children:(0,l.jsx)("span",{className:e.late_days_unexcused>=4?"text-red-600":e.late_days_unexcused>=2?"text-amber-600":"text-green-600",children:e.late_days_unexcused})}),(0,l.jsxs)("td",{className:"py-2.5 px-3 text-center text-slate-700",children:[e.total_hours,"h"]}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center",children:(0,l.jsx)(v,{label:e.impact_label,text:e.commission_impact})}),(0,l.jsx)("td",{className:"py-2.5 px-1",children:(0,l.jsx)("button",{onClick:()=>D(e.user_id),className:"text-blue-600 hover:text-blue-800 text-xs font-semibold",children:"View"})})]},e.user_id))})]})})]}),Z&&y&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("h3",{className:"font-display text-lg font-bold text-slate-900",children:[y.name," — ",y.period]}),(0,l.jsx)("button",{onClick:()=>_(null),className:"text-slate-400 hover:text-slate-600",children:(0,l.jsx)(r.Z,{size:20})})]}),(0,l.jsx)(N,{summary:y.summary}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(g,{entries:y.entries,isAdmin:!0,onExcuse:E,onUnexcuse:S})})]})]})]})}let N=e=>{let{summary:t}=e;return(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,l.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,l.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:t.total_days}),(0,l.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"Days Worked"})]}),(0,l.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,l.jsx)("p",{className:"text-2xl font-bold text-green-700",children:t.on_time_days}),(0,l.jsx)("p",{className:"text-xs text-green-600 font-medium",children:"On Time"})]}),(0,l.jsxs)("div",{className:"bg-amber-50 rounded-lg p-3 text-center",children:[(0,l.jsx)("p",{className:"text-2xl font-bold text-amber-700",children:t.late_days_unexcused}),(0,l.jsx)("p",{className:"text-xs text-amber-600 font-medium",children:"Late (Unexcused)"})]}),(0,l.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3 text-center",children:[(0,l.jsxs)("p",{className:"text-2xl font-bold text-slate-700",children:[t.total_hours,"h"]}),(0,l.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"Total Hours"})]}),(0,l.jsxs)("div",{className:"rounded-lg p-3 text-center ".concat("bonus"===t.impact_label?"bg-green-50":"penalty"===t.impact_label?"bg-red-50":"bg-slate-50"),children:[(0,l.jsx)(v,{label:t.impact_label,text:t.commission_impact,size:"lg"}),(0,l.jsx)("p",{className:"text-xs text-slate-500 font-medium mt-1",children:"Commission Impact"})]})]})},v=e=>{let{label:t,text:s,size:a}=e,n="lg"===a;return"bonus"===t?(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 ".concat(n?"text-xl font-bold":"text-xs font-semibold"," text-green-700"),children:[(0,l.jsx)(o.Z,{size:n?20:14}),(0,l.jsx)("span",{children:s})]}):"penalty"===t?(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 ".concat(n?"text-xl font-bold":"text-xs font-semibold"," text-red-600"),children:[(0,l.jsx)(h,{size:n?20:14}),(0,l.jsx)("span",{children:s})]}):(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 ".concat(n?"text-xl font-bold":"text-xs font-semibold"," text-slate-500"),children:[(0,l.jsx)(u,{size:n?20:14}),(0,l.jsx)("span",{children:s})]})},g=e=>{let{entries:t,isAdmin:s,onExcuse:a,onUnexcuse:n}=e,i=e=>e?new Date(e+(e.endsWith("Z")?"":"Z")).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"—",c=e=>new Date(e+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b border-slate-200 text-left",children:[(0,l.jsx)("th",{className:"py-2 pr-4 font-semibold text-slate-600",children:"Date"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600",children:"Clock In"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600",children:"Clock Out"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Hours"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Location"}),(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Status"}),s&&(0,l.jsx)("th",{className:"py-2 px-3 font-semibold text-slate-600 text-center",children:"Action"})]})}),(0,l.jsx)("tbody",{children:t.map(e=>(0,l.jsxs)("tr",{className:"border-b border-slate-100 ".concat(e.is_late&&!e.excused?"bg-red-50/50":""),children:[(0,l.jsx)("td",{className:"py-2.5 pr-4 font-medium text-slate-900",children:c(e.work_date)}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-slate-700",children:i(e.clock_in)}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-slate-700",children:e.clock_out?i(e.clock_out):"—"}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center text-slate-700",children:null!=e.hours_worked?"".concat(e.hours_worked,"h"):"—"}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center",children:!0===e.is_at_office?(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 text-green-600 text-xs font-semibold",children:[(0,l.jsx)(p.Z,{size:13}),(0,l.jsx)("span",{children:"At Office"})]}):!1===e.is_at_office?(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 text-amber-600 text-xs font-semibold",children:[(0,l.jsx)(p.Z,{size:13}),(0,l.jsx)("span",{children:"Remote"})]}):(0,l.jsx)("span",{className:"text-slate-400 text-xs",children:"—"})}),(0,l.jsx)("td",{className:"py-2.5 px-3 text-center",children:e.is_late?e.excused?(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 text-blue-600 text-xs font-semibold",children:[(0,l.jsx)(j.Z,{size:14}),(0,l.jsx)("span",{children:"Excused"})]}):(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 text-red-600 text-xs font-semibold",children:[(0,l.jsx)(f.Z,{size:14}),(0,l.jsxs)("span",{children:[e.minutes_late,"m late"]})]}):(0,l.jsxs)("span",{className:"inline-flex items-center space-x-1 text-green-600 text-xs font-semibold",children:[(0,l.jsx)(b.Z,{size:14}),(0,l.jsx)("span",{children:"On Time"})]})}),s&&(0,l.jsxs)("td",{className:"py-2.5 px-3 text-center",children:[e.is_late&&!e.excused&&(0,l.jsx)("button",{onClick:()=>a(e.id),className:"text-blue-600 hover:text-blue-800 text-xs font-semibold",children:"Excuse"}),e.is_late&&e.excused&&(0,l.jsx)("button",{onClick:()=>n(e.id),className:"text-slate-400 hover:text-red-500 text-xs font-semibold",children:"Unexcuse"})]})]},e.id))})]})})}}},function(e){e.O(0,[597,228,888,774,179],function(){return e(e.s=3809)}),_N_E=e.O()}]);