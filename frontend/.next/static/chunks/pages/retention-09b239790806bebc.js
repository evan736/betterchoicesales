(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[614],{3413:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/retention",function(){return s(9727)}])},9727:function(e,t,s){"use strict";s.r(t);var a=s(5893),l=s(7294),r=s(1163),c=s(9835),i=s(3740),n=s(8856),d=s(8451),x=s(4831),o=s(4195),h=s(3023),m=s(5358),p=s(6050),j=s(8001),b=s(3815),y=s(8687),g=s(6880),N=s(9455),f=s(9525),u=s(1240),v=s(8082),_=s(1853),w=s(8971);let k=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4"],S=e=>{let{label:t,value:s,color:l}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold ".concat(l||"text-slate-900"),children:s}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:t})]})},C=e=>{let{rate:t}=e,s=t>=85?"bg-green-100 text-green-700":t>=70?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700";return(0,a.jsxs)("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs font-bold ".concat(s),children:[t,"%"]})};t.default=()=>{let{user:e,loading:t}=(0,c.a)(),s=(0,r.useRouter)(),[R,z]=(0,l.useState)(null),[K,q]=(0,l.useState)([]),[A,P]=(0,l.useState)([]),[T,D]=(0,l.useState)([]),[E,F]=(0,l.useState)([]),[B,Z]=(0,l.useState)([]),[L,$]=(0,l.useState)(!0),[M,O]=(0,l.useState)("overview"),[X,Y]=(0,l.useState)("");(0,l.useEffect)(()=>{if(!t&&!e){s.push("/");return}e&&U()},[e,t,X]);let U=async()=>{$(!0);try{let e=X||void 0,[t,s,a,l,r,c]=await Promise.all([n.lq.overview(e),n.lq.byAgent(e),n.lq.byCarrier(e),n.lq.bySource(e),n.lq.trend(12),n.lq.earlyCancellations(120,e)]);z(t.data),q(s.data),P(a.data),D(l.data),F(r.data),Z(c.data)}catch(e){console.error("Failed to load retention data:",e)}finally{$(!1)}};if(t||!e)return null;let W=[{key:"overview",label:"Overview",icon:N.Z},{key:"agent",label:"By Agent",icon:f.Z},{key:"carrier",label:"By Carrier",icon:u.Z},{key:"source",label:"By Lead Source",icon:v.Z},{key:"list",label:"Early Cancellations",icon:_.Z}],G=[{value:"",label:"All Time"}],H=new Date;for(let e=0;e<12;e++){let t=new Date(H.getFullYear(),H.getMonth()-e,1),s="".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0")),a=t.toLocaleDateString("en-US",{month:"long",year:"numeric"});G.push({value:s,label:a})}return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,a.jsx)(i.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Retention Analytics"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Track early terminations and retention rates"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{value:X,onChange:e=>Y(e.target.value),className:"appearance-none bg-white border border-slate-300 rounded-lg px-4 py-2 pr-8 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500",children:G.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)(w.Z,{size:14,className:"absolute right-2.5 top-3 text-slate-400 pointer-events-none"})]})]}),(0,a.jsx)("div",{className:"flex space-x-1 bg-white rounded-xl p-1 shadow-sm border border-slate-200 mb-6",children:W.map(e=>(0,a.jsxs)("button",{onClick:()=>O(e.key),className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(M===e.key?"bg-green-600 text-white shadow-sm":"text-slate-600 hover:bg-slate-100"),children:[(0,a.jsx)(e.icon,{size:16}),(0,a.jsx)("span",{children:e.label})]},e.key))}),L?(0,a.jsx)("div",{className:"text-center py-20 text-slate-500",children:"Loading retention data..."}):(0,a.jsxs)(a.Fragment,{children:["overview"===M&&R&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)(S,{label:"Total Policies",value:R.total_sales}),(0,a.jsx)(S,{label:"Active",value:R.total_active,color:"text-green-700"}),(0,a.jsx)(S,{label:"Cancelled",value:R.total_cancelled,color:"text-red-600"}),(0,a.jsx)(S,{label:"Retention Rate",value:"".concat(R.retention_rate,"%"),color:R.retention_rate>=85?"text-green-700":R.retention_rate>=70?"text-amber-600":"text-red-600"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-800 mb-4",children:"Cancellations by Time Period"}),(0,a.jsx)(d.h,{width:"100%",height:280,children:(0,a.jsxs)(x.v,{data:R.bucket_chart_data,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(h.K,{dataKey:"name",tick:{fontSize:12}}),(0,a.jsx)(m.B,{tick:{fontSize:12}}),(0,a.jsx)(p.u,{}),(0,a.jsx)(j.$,{dataKey:"count",radius:[6,6,0,0],children:R.bucket_chart_data.map((e,t)=>(0,a.jsx)(b.b,{fill:k[t]},t))})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-800 mb-4",children:"Monthly Retention Rate Trend"}),(0,a.jsx)(d.h,{width:"100%",height:280,children:(0,a.jsxs)(y.w,{data:E,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(h.K,{dataKey:"month",tick:{fontSize:11}}),(0,a.jsx)(m.B,{domain:[0,100],tick:{fontSize:12},tickFormatter:e=>"".concat(e,"%")}),(0,a.jsx)(p.u,{formatter:e=>["".concat(e,"%"),"Retention Rate"]}),(0,a.jsx)(g.x,{type:"monotone",dataKey:"retention_rate",stroke:"#16a34a",strokeWidth:2.5,dot:{r:4}})]})})]})]})]}),"agent"===M&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-5 border-b border-slate-200",children:(0,a.jsx)("h3",{className:"font-semibold text-slate-800",children:"Retention by Agent"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-600",children:"Agent"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Total"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Active"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-red-600",children:"Cancelled"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Retention"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"0-30d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"31-60d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"61-90d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"91-120d"})]})}),(0,a.jsx)("tbody",{children:K.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 ".concat(t%2?"bg-slate-50/50":""),children:[(0,a.jsx)("td",{className:"py-2.5 px-4 font-medium",children:e.agent_name}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.total_sales}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-green-700",children:e.active}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-red-600",children:e.cancelled}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:(0,a.jsx)(C,{rate:e.retention_rate})}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_30||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_60||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_90||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_120||"—"})]},e.agent_id))})]})}),K.length>0&&(0,a.jsx)("div",{className:"p-5 border-t border-slate-200",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(x.v,{data:K,layout:"vertical",children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(h.K,{type:"number",domain:[0,100],tickFormatter:e=>"".concat(e,"%")}),(0,a.jsx)(m.B,{type:"category",dataKey:"agent_name",width:120,tick:{fontSize:12}}),(0,a.jsx)(p.u,{formatter:e=>["".concat(e,"%"),"Retention Rate"]}),(0,a.jsx)(j.$,{dataKey:"retention_rate",radius:[0,6,6,0],children:K.map((e,t)=>(0,a.jsx)(b.b,{fill:e.retention_rate>=85?"#22c55e":e.retention_rate>=70?"#eab308":"#ef4444"},t))})]})})})]}),"carrier"===M&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-5 border-b border-slate-200",children:(0,a.jsx)("h3",{className:"font-semibold text-slate-800",children:"Retention by Carrier"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-600",children:"Carrier"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Total"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Active"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-red-600",children:"Cancelled"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Retention"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"0-30d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"31-60d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"61-90d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"91-120d"})]})}),(0,a.jsx)("tbody",{children:A.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 ".concat(t%2?"bg-slate-50/50":""),children:[(0,a.jsx)("td",{className:"py-2.5 px-4 font-medium capitalize",children:(e.carrier||"").replace("_"," ")}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.total_sales}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-green-700",children:e.active}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-red-600",children:e.cancelled}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:(0,a.jsx)(C,{rate:e.retention_rate})}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_30||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_60||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_90||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_120||"—"})]},e.carrier))})]})}),A.length>0&&(0,a.jsx)("div",{className:"p-5 border-t border-slate-200",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(x.v,{data:A,children:[(0,a.jsx)(o.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(h.K,{dataKey:"carrier",tick:{fontSize:12}}),(0,a.jsx)(m.B,{domain:[0,100],tickFormatter:e=>"".concat(e,"%")}),(0,a.jsx)(p.u,{formatter:e=>["".concat(e,"%"),"Retention Rate"]}),(0,a.jsx)(j.$,{dataKey:"retention_rate",radius:[6,6,0,0],children:A.map((e,t)=>(0,a.jsx)(b.b,{fill:e.retention_rate>=85?"#22c55e":e.retention_rate>=70?"#eab308":"#ef4444"},t))})]})})})]}),"source"===M&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-5 border-b border-slate-200",children:(0,a.jsx)("h3",{className:"font-semibold text-slate-800",children:"Retention by Lead Source"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-600",children:"Lead Source"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Total"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Active"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-red-600",children:"Cancelled"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"Retention"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"0-30d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"31-60d"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-slate-600",children:"61-90d"})]})}),(0,a.jsx)("tbody",{children:T.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 ".concat(t%2?"bg-slate-50/50":""),children:[(0,a.jsx)("td",{className:"py-2.5 px-4 font-medium capitalize",children:(e.lead_source||"").replace("_"," ")}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.total_sales}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-green-700",children:e.active}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right text-red-600",children:e.cancelled}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:(0,a.jsx)(C,{rate:e.retention_rate})}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_30||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_60||"—"}),(0,a.jsx)("td",{className:"py-2.5 px-4 text-right",children:e.cancel_90||"—"})]},e.lead_source))})]})})]}),"list"===M&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-5 border-b border-slate-200",children:[(0,a.jsx)("h3",{className:"font-semibold text-slate-800",children:"Early Cancellations (within 120 days)"}),(0,a.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:[B.length," policies"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2.5 px-3 font-semibold text-slate-600",children:"Policy #"}),(0,a.jsx)("th",{className:"text-left py-2.5 px-3 font-semibold text-slate-600",children:"Client"}),(0,a.jsx)("th",{className:"text-left py-2.5 px-3 font-semibold text-slate-600",children:"Carrier"}),(0,a.jsx)("th",{className:"text-left py-2.5 px-3 font-semibold text-slate-600",children:"Producer"}),(0,a.jsx)("th",{className:"text-left py-2.5 px-3 font-semibold text-slate-600",children:"Source"}),(0,a.jsx)("th",{className:"text-right py-2.5 px-3 font-semibold text-slate-600",children:"Premium"}),(0,a.jsx)("th",{className:"text-center py-2.5 px-3 font-semibold text-slate-600",children:"Effective"}),(0,a.jsx)("th",{className:"text-center py-2.5 px-3 font-semibold text-slate-600",children:"Cancelled"}),(0,a.jsx)("th",{className:"text-center py-2.5 px-3 font-semibold text-red-600",children:"Days"}),(0,a.jsx)("th",{className:"text-center py-2.5 px-3 font-semibold text-slate-600",children:"Comm Status"})]})}),(0,a.jsx)("tbody",{children:B.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 ".concat(t%2?"bg-slate-50/50":""),children:[(0,a.jsx)("td",{className:"py-2 px-3 font-mono",children:e.policy_number}),(0,a.jsx)("td",{className:"py-2 px-3",children:e.client_name}),(0,a.jsx)("td",{className:"py-2 px-3 capitalize",children:(e.carrier||"").replace("_"," ")}),(0,a.jsx)("td",{className:"py-2 px-3",children:e.producer}),(0,a.jsx)("td",{className:"py-2 px-3 capitalize",children:(e.lead_source||"").replace("_"," ")}),(0,a.jsxs)("td",{className:"py-2 px-3 text-right",children:["$",(e.written_premium||0).toLocaleString(void 0,{minimumFractionDigits:2})]}),(0,a.jsx)("td",{className:"py-2 px-3 text-center",children:e.effective_date||"—"}),(0,a.jsx)("td",{className:"py-2 px-3 text-center",children:e.cancelled_date||"—"}),(0,a.jsx)("td",{className:"py-2 px-3 text-center",children:(0,a.jsxs)("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs font-bold ".concat(e.days_to_cancel<=30?"bg-red-100 text-red-700":e.days_to_cancel<=60?"bg-orange-100 text-orange-700":e.days_to_cancel<=90?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"),children:[e.days_to_cancel,"d"]})}),(0,a.jsx)("td",{className:"py-2 px-3 text-center",children:(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full ".concat("paid"===e.commission_status?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"),children:"paid"===e.commission_status?"Paid":"Pending"})})]},e.id))})]})})]})]})]})]})}}},function(e){e.O(0,[597,869,655,228,888,774,179],function(){return e(e.s=3413)}),_N_E=e.O()}]);