(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[583],{8274:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/analytics",function(){return l(7312)}])},7312:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return S}});var a=l(5893),s=l(7294),r=l(1163),n=l(9835),i=l(3740),o=l(2502),c=l(8856),d=l(8451),x=l(4831),m=l(4195),u=l(3023),p=l(5358),b=l(6050),h=l(8001),g=l(3815),f=l(6942),j=l(9858),y=l(3766),v=l(9525);let N=["#0ea5e9","#0284c7","#0369a1","#075985","#0c4a6e","#38bdf8","#7dd3fc","#bae6fd","#d97706","#f59e0b","#10b981","#ef4444"],_=[{value:"lead_source",label:"Lead Source"},{value:"producer",label:"Producer"},{value:"policy_type",label:"Policy Type"},{value:"carrier",label:"Carrier"},{value:"state",label:"State"}],w=[{value:"monthly",label:"This Month"},{value:"last_month",label:"Last Month"},{value:"annual",label:"This Year"},{value:"last_year",label:"Last Year"},{value:"all-time",label:"All Time"}];function S(){let{user:e,loading:t}=(0,n.a)(),l=(0,r.useRouter)(),[S,D]=(0,s.useState)("monthly"),[E,Z]=(0,s.useState)("lead_source"),[F,L]=(0,s.useState)(null),[z,A]=(0,s.useState)([]),[O,B]=(0,s.useState)([]),[Y,I]=(0,s.useState)(0),[K,$]=(0,s.useState)(null),[G,M]=(0,s.useState)(!0),[R,X]=(0,s.useState)(null),[q,H]=(0,s.useState)({}),[J,Q]=(0,s.useState)("sale_date"),[U,V]=(0,s.useState)("desc");(0,s.useEffect)(()=>{t||e?e&&(W(),ee()):l.push("/")},[e,t]),(0,s.useEffect)(()=>{e&&ee()},[S,E,q,J,U]);let W=async()=>{try{let e=await c.n9.filterOptions();$(e.data)}catch(e){console.error(e)}},ee=async()=>{M(!0);try{let e=new Date,t={};"last_year"===S&&(t.year=e.getFullYear()-1);let l="last_year"===S?"annual":"all-time"===S?void 0:S,[a,s,r,n]=await Promise.all([c.n9.summary({period:l,...t}),c.n9.byGroup({group_by:E,period:l,...t}),c.n9.salesTable({period:l,sort_by:J,sort_order:U,...t,...q,limit:50}),c.n9.trending({period:"all-time"===S?"annual":"last_month"===S?"monthly":S})]);L(a.data),A(s.data.results||[]),B(r.data.sales||[]),I(r.data.total||0),X(n.data)}catch(e){console.error(e)}finally{M(!1)}};if(t||!e)return null;let et=e=>"$".concat(e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}));return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(i.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-display text-4xl font-bold text-slate-900 mb-2",children:"Sales Analytics"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Agency performance, filtered by any dimension"})]}),(0,a.jsx)("div",{className:"flex items-center gap-3 flex-wrap",children:w.map(e=>(0,a.jsx)("button",{onClick:()=>D(e.value),className:"px-4 py-2 rounded-lg font-semibold text-sm transition-all ".concat(S===e.value?"bg-brand-600 text-white shadow-md":"bg-white text-slate-600 border border-slate-200 hover:border-brand-300"),children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(C,{icon:(0,a.jsx)(f.Z,{}),label:"Total Premium",value:et((null==F?void 0:F.total_premium)||0),color:"text-green-600",bg:"bg-green-100"}),(0,a.jsx)(C,{icon:(0,a.jsx)(j.Z,{}),label:"last_year"===S?"Last Year Total":"Projected",value:R?et(R.projected_premium):"—",color:"text-brand-600",bg:"bg-brand-100"}),(0,a.jsx)(C,{icon:(0,a.jsx)(y.Z,{}),label:"Daily Pace",value:R&&R.daily_pace>0?et(R.daily_pace):"—",color:"text-blue-600",bg:"bg-blue-100"}),(0,a.jsx)(C,{icon:(0,a.jsx)(v.Z,{}),label:"Policies / Items",value:"".concat((null==F?void 0:F.total_policies)||0," / ").concat((null==F?void 0:F.total_items)||0),color:"text-purple-600",bg:"bg-purple-100"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,a.jsx)(o.Z,{period:S,showGoals:!1}),(0,a.jsx)(o.Z,{period:S,showTrending:!1})]}),(0,a.jsxs)("div",{className:"card mb-8",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[(0,a.jsx)("h2",{className:"font-display text-2xl font-bold text-slate-900",children:"Premium Breakdown"}),(0,a.jsx)("div",{className:"flex items-center gap-2 flex-wrap",children:_.map(e=>(0,a.jsx)("button",{onClick:()=>Z(e.value),className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-all ".concat(E===e.value?"bg-brand-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:e.label},e.value))})]}),0===z.length?(0,a.jsx)("div",{className:"text-center py-16 text-slate-400",children:"No data for this period"}):(0,a.jsx)(d.h,{width:"100%",height:380,children:(0,a.jsxs)(x.v,{data:z,margin:{top:10,right:30,left:10,bottom:60},children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(u.K,{dataKey:"group",tick:{fontSize:12,fill:"#64748b"},angle:-35,textAnchor:"end",interval:0,height:80}),(0,a.jsx)(p.B,{tick:{fontSize:12,fill:"#64748b"},tickFormatter:e=>"$".concat((e/1e3).toFixed(0),"k")}),(0,a.jsx)(b.u,{formatter:e=>[et(e),"Premium"],contentStyle:{borderRadius:"12px",border:"1px solid #e2e8f0"}}),(0,a.jsx)(h.$,{dataKey:"total_premium",radius:[6,6,0,0],children:z.map((e,t)=>(0,a.jsx)(g.b,{fill:N[t%N.length]},t))})]})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[(0,a.jsxs)("h2",{className:"font-display text-2xl font-bold text-slate-900",children:["Sales (",Y,")"]}),(0,a.jsx)("div",{className:"flex items-center gap-2 flex-wrap",children:K&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P,{label:"Source",value:q.lead_source||"",onChange:e=>H({...q,lead_source:e||void 0}),options:K.lead_sources.map(e=>({value:e,label:e.replace(/_/g," ")}))}),(0,a.jsx)(P,{label:"Type",value:q.policy_type||"",onChange:e=>H({...q,policy_type:e||void 0}),options:K.policy_types.map(e=>({value:e,label:e.replace(/_/g," ")}))}),K.carriers.length>0&&(0,a.jsx)(P,{label:"Carrier",value:q.carrier||"",onChange:e=>H({...q,carrier:e||void 0}),options:K.carriers.map(e=>({value:e,label:e}))}),K.states.length>0&&(0,a.jsx)(P,{label:"State",value:q.state||"",onChange:e=>H({...q,state:e||void 0}),options:K.states.map(e=>({value:e,label:e}))}),K.producers.length>0&&(0,a.jsx)(P,{label:"Producer",value:q.producer_id||"",onChange:e=>H({...q,producer_id:e?parseInt(e):void 0}),options:K.producers.map(e=>({value:String(e.id),label:e.name}))})]})})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,a.jsx)(k,{label:"Sale Date",field:"sale_date",sortBy:J,sortOrder:U,onSort:(e,t)=>{Q(e),V(t)}}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Policy #"}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Customer"}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Type"}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Carrier"}),(0,a.jsx)(k,{label:"Premium",field:"written_premium",sortBy:J,sortOrder:U,onSort:(e,t)=>{Q(e),V(t)}}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Items"}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Source"}),(0,a.jsx)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600",children:"Producer"})]})}),(0,a.jsxs)("tbody",{children:[O.map(e=>(0,a.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-brand-50/30 transition-colors",children:[(0,a.jsx)("td",{className:"py-3 px-3 text-slate-700",children:e.sale_date?new Date(e.sale_date).toLocaleDateString():"—"}),(0,a.jsx)("td",{className:"py-3 px-3 font-medium text-slate-900",children:e.policy_number}),(0,a.jsx)("td",{className:"py-3 px-3 text-slate-700",children:e.client_name}),(0,a.jsx)("td",{className:"py-3 px-3",children:(0,a.jsx)(T,{type:e.policy_type})}),(0,a.jsx)("td",{className:"py-3 px-3 text-slate-700",children:e.carrier||"—"}),(0,a.jsx)("td",{className:"py-3 px-3 font-bold text-brand-600",children:et(e.written_premium)}),(0,a.jsx)("td",{className:"py-3 px-3 text-center text-slate-700",children:e.item_count}),(0,a.jsx)("td",{className:"py-3 px-3 text-slate-600 text-xs",children:(e.lead_source||"").replace(/_/g," ")}),(0,a.jsx)("td",{className:"py-3 px-3 text-slate-700",children:e.producer_name})]},e.id)),0===O.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"py-12 text-center text-slate-400",children:"No sales match your filters"})})]})]})})]})]})]})}let C=e=>{let{icon:t,label:l,value:s,color:r,bg:n}=e;return(0,a.jsxs)("div",{className:"stat-card",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat(n," ").concat(r," w-fit mb-3"),children:t}),(0,a.jsx)("div",{className:"text-3xl font-bold text-slate-900",children:s}),(0,a.jsx)("div",{className:"text-sm text-slate-600 font-medium",children:l})]})},P=e=>{let{label:t,value:l,onChange:s,options:r}=e;return(0,a.jsxs)("select",{value:l,onChange:e=>s(e.target.value),className:"px-3 py-1.5 rounded-lg text-sm border border-slate-200 bg-white text-slate-700 focus:border-brand-400 focus:ring-1 focus:ring-brand-200 outline-none capitalize",children:[(0,a.jsxs)("option",{value:"",children:["All ",t,"s"]}),r.map(e=>(0,a.jsx)("option",{value:e.value,className:"capitalize",children:e.label},e.value))]})},k=e=>{let{label:t,field:l,sortBy:s,sortOrder:r,onSort:n}=e;return(0,a.jsxs)("th",{className:"text-left py-3 px-3 font-semibold text-slate-600 cursor-pointer hover:text-brand-600 select-none",onClick:()=>n(l,s===l&&"desc"===r?"asc":"desc"),children:[t," ",s===l&&("desc"===r?"↓":"↑")]})},T=e=>{let{type:t}=e;return t?(0,a.jsx)("span",{className:"badge ".concat({auto:"bg-blue-100 text-blue-800",home:"bg-green-100 text-green-800",renters:"bg-purple-100 text-purple-800",condo:"bg-teal-100 text-teal-800",landlord:"bg-orange-100 text-orange-800",bundled:"bg-yellow-100 text-yellow-800",life:"bg-red-100 text-red-800",rv:"bg-indigo-100 text-indigo-800",commercial:"bg-gray-100 text-gray-800"}[t]||"bg-slate-100 text-slate-700"," capitalize"),children:t.replace(/_/g," ")}):(0,a.jsx)("span",{className:"text-slate-400 text-xs",children:"—"})}}},function(e){e.O(0,[597,869,228,116,888,774,179],function(){return e(e.s=8274)}),_N_E=e.O()}]);